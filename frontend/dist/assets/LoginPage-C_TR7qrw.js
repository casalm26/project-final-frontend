import{r as o,j as e,L as f,u as j,a as k}from"./index-Bdj1OuIn.js";import{N as w}from"./Navbar-CFI5vrxq.js";import{F as y,P as v}from"./PasswordInput-BTnokICh.js";import"./vendor-BtP0CW_r.js";import"./useKeyboardNavigation-HrnEcNsd.js";import"./DarkModeToggle-BK3IjmYc.js";import"./IconButton-BRz3y-_5.js";const C=({connectionState:r,onCancel:t,showCancel:l=!0})=>{const[a,i]=o.useState(0),[c,u]=o.useState(0),{isConnecting:s,isColdStart:n,retryAttempt:d,totalAttempts:h,estimatedWaitTime:p,message:g}=r;return o.useEffect(()=>{if(!s){i(0),u(0);return}const x=setInterval(()=>{if(u(m=>m+1),n){const b=Math.min(c/60*100,90);i(b)}else{const b=Math.min(c/10*100,90);i(b)}},1e3);return()=>clearInterval(x)},[s,n,c]),o.useEffect(()=>{!s&&a>0&&i(100)},[s,a]),s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-8 max-w-md w-full mx-4 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsxs("svg",{className:"w-8 h-8 text-green-600 dark:text-green-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n?"Server Starting Up":"Connecting"})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-2",children:g}),n&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:"The server needs to start up from sleep mode."}),e.jsx("p",{children:"This usually takes 30-60 seconds."})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round(a),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-1000 ease-out",style:{width:`${a}%`}})})]}),d>0&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["Attempt ",d," of ",h]}),e.jsxs("span",{className:"text-blue-500 dark:text-blue-300",children:[c,"s elapsed"]})]})}),p>0&&e.jsxs("div",{className:"text-center text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Estimated wait time: ",p," seconds"]}),l&&t&&e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:t,className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-sm underline",children:"Cancel and try again later"})})]})}):null},N=(r,t)=>{const[l,a]=o.useState(r),[i,c]=o.useState({}),[u,s]=o.useState({}),n=o.useCallback(g=>{const{name:x,value:m}=g.target;a(b=>({...b,[x]:m})),i[x]&&c(b=>({...b,[x]:""}))},[i]),d=o.useCallback(g=>{const{name:x}=g.target;s(m=>({...m,[x]:!0}))},[]),h=o.useCallback(()=>{const g=t(l);return c(g),Object.keys(g).length===0},[l,t]),p=o.useCallback(()=>{a(r),c({}),s({})},[r]);return{values:l,errors:i,touched:u,handleChange:n,handleBlur:d,validateForm:h,resetForm:p,setErrors:c}},S=r=>{const t={};return r.email?/\S+@\S+\.\S+/.test(r.email)||(t.email="Email is invalid"):t.email="Email is required",r.password?r.password.length<6&&(t.password="Password must be at least 6 characters"):t.password="Password is required",t},A=({onSubmit:r,isSubmitting:t,errors:l})=>{const{values:a,errors:i,handleChange:c,handleBlur:u,validateForm:s}=N({email:"",password:""},S),n={...i,...l},d=h=>{h.preventDefault(),s()&&r(a)};return e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[n.general&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded-lg",children:n.general}),e.jsx(y,{label:"Email address",id:"email",error:n.email,required:!0,children:e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:c,onBlur:u,className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 ${n.email?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Enter your email",disabled:t})}),e.jsx(y,{children:e.jsx(v,{id:"password",name:"password",value:a.password,onChange:c,onBlur:u,error:n.password,placeholder:"Enter your password",required:!0,disabled:t})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{disabled:t}),e.jsx(F,{})]}),e.jsx(T,{isSubmitting:t}),e.jsx(P,{})]})},E=({disabled:r})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700",disabled:r}),e.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Remember me"})]}),F=()=>e.jsx("div",{className:"text-sm",children:e.jsx("a",{href:"#",className:"font-medium text-green-600 dark:text-green-400 hover:text-green-500 dark:hover:text-green-300",children:"Forgot your password?"})}),T=({isSubmitting:r})=>e.jsx("button",{type:"submit",disabled:r,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-green-600 dark:bg-green-500 hover:bg-green-700 dark:hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):"Sign in"}),P=()=>e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Don't have an account?"," ",e.jsx(f,{to:"/register",className:"font-medium text-green-600 dark:text-green-400 hover:text-green-500 dark:hover:text-green-300",children:"Sign up"})]})}),L=()=>e.jsxs("div",{className:"mt-8 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Demo credentials:"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Admin:"})," admin@nanwa.com / admin123"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"User:"})," user@nanwa.com / user123"]})]})]}),M=()=>{const[r,t]=o.useState({isConnecting:!1,isColdStart:!1,retryAttempt:0,totalAttempts:0,estimatedWaitTime:0,message:"",error:null}),l=o.useCallback(s=>{const{attempt:n,totalAttempts:d,delay:h,error:p,isColdStart:g}=s;t(x=>({...x,isConnecting:!0,isColdStart:g,retryAttempt:n,totalAttempts:d,estimatedWaitTime:Math.ceil(h/1e3),message:W(n,d,g),error:null}))},[]),a=o.useCallback(()=>{t({isConnecting:!0,isColdStart:!1,retryAttempt:0,totalAttempts:0,estimatedWaitTime:10,message:"Connecting to server...",error:null})},[]),i=o.useCallback(()=>{t({isConnecting:!1,isColdStart:!1,retryAttempt:0,totalAttempts:0,estimatedWaitTime:0,message:"Connected successfully!",error:null})},[]),c=o.useCallback(s=>{const n=s&&typeof s=="object"?s.message||String(s):String(s||"Connection failed");t(d=>({...d,isConnecting:!1,error:n,message:"Connection failed. Please try again."}))},[]),u=o.useCallback(()=>{t({isConnecting:!1,isColdStart:!1,retryAttempt:0,totalAttempts:0,estimatedWaitTime:0,message:"",error:null})},[]);return{connectionState:r,handleRetry:l,startConnection:a,connectionSuccess:i,connectionFailed:c,resetConnection:u}},W=(r,t,l)=>r===1&&l?"Server is starting up, this may take up to 60 seconds...":r===2&&l?"Still starting up, please wait...":r===3&&l?"Almost ready, just a few more seconds...":r>=4&&l?"Final attempt, server should be ready soon...":`Retrying connection (${r}/${t})...`,B=()=>{const[r,t]=o.useState({}),[l,a]=o.useState(!1),{login:i}=j();k();const{connectionState:c,handleRetry:u,startConnection:s,connectionSuccess:n,connectionFailed:d,resetConnection:h}=M();return{errors:r,isSubmitting:l,connectionState:c,handleLogin:async x=>{a(!0),t({}),s();try{const m=await i(x.email,x.password,u);m.success?n():(d(new Error(m.error)),t({general:m.error}))}catch(m){d(m),t({general:"Connection failed. Please check your internet connection and try again."})}finally{a(!1)}},handleCancelConnection:()=>{h(),a(!1)}}},V=()=>{const{errors:r,isSubmitting:t,connectionState:l,handleLogin:a,handleCancelConnection:i}=B();return e.jsxs(e.Fragment,{children:[e.jsx(w,{}),e.jsx(C,{connectionState:l,onCancel:i,showCancel:!0}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-green-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md",children:[e.jsx(R,{}),e.jsx(A,{onSubmit:a,isSubmitting:t,errors:r}),e.jsx(L,{})]})})]})},R=()=>e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(f,{to:"/",className:"inline-block mb-6",children:e.jsx("h1",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:"Nanwa"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Welcome back"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Sign in to your account to continue"})]});export{V as LoginPage};
