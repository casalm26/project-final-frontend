import{j as s,n as oe,r as S,b as q,u as W,o as U,d as T,h as ie,N as le}from"./index-CJti3Ljs.js";import{E as de,T as ce,a as ue,b as X,c as z,d as _,S as ge,e as me,f as he,g as fe,M as pe}from"./Modal-DbylYopw.js";import{F as xe,S as ee,a as ye,A as be,P as ve}from"./FormElements-BDDhlZG9.js";import{a as te}from"./dataService-2Ma-xxGM.js";import{D as je}from"./DarkModeToggle-C6MT5bvb.js";import{u as Se}from"./with-selector-C5k5o92S.js";import{f as N}from"./forestService-DvXcQtLH.js";import{t as F}from"./treeService-Cy-UAXFz.js";import{F as A}from"./FormField-BztHri5e.js";import{c as we,l as ke,a as Te,e as Ee,M as Ce,T as Ae,b as Fe,L as re}from"./leaflet-B-vzmiwJ.js";import"./vendor-BtP0CW_r.js";import"./IconButton-DbV4qPVt.js";const Ne=we(function({position:o,...e},t){const a=new ke.Marker(o,e);return Te(a,Ee(t,{overlayContainer:a}))},function(o,e,t){e.position!==t.position&&o.setLatLng(e.position),e.icon!=null&&e.icon!==t.icon&&o.setIcon(e.icon),e.zIndexOffset!=null&&e.zIndexOffset!==t.zIndexOffset&&o.setZIndexOffset(e.zIndexOffset),e.opacity!=null&&e.opacity!==t.opacity&&o.setOpacity(e.opacity),o.dragging!=null&&e.draggable!==t.draggable&&(e.draggable===!0?o.dragging.enable():o.dragging.disable())}),D={CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",LOGIN:"LOGIN",LOGOUT:"LOGOUT"},_e=[{value:"",label:"All Actions"},{value:D.CREATE,label:"Create"},{value:D.UPDATE,label:"Update"},{value:D.DELETE,label:"Delete"},{value:D.LOGIN,label:"Login"},{value:D.LOGOUT,label:"Logout"}],se=10,Ie=({searchTerm:r,setSearchTerm:o,actionFilter:e,setActionFilter:t})=>s.jsxs(xe,{children:[s.jsx(ee,{type:"text",placeholder:"Search by user, action, or details...",value:r,onChange:a=>o(a.target.value)}),s.jsx(ye,{value:e,onChange:a=>t(a.target.value),children:_e.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))})]}),Le={ASC:"asc"},$={NONE:"⇅",ASC:"↑",DESC:"↓"},De=(r,o,e)=>o!==r?$.NONE:e===Le.ASC?$.ASC:$.DESC,O=({field:r,sortField:o,sortDirection:e,onSort:t,children:a})=>s.jsxs(z,{onClick:()=>t(r),children:[a," ",s.jsx(ge,{children:De(r,o,e)})]}),Me=({sortField:r,sortDirection:o,onSort:e})=>s.jsx(ue,{children:s.jsxs(X,{children:[s.jsx(O,{field:"timestamp",sortField:r,sortDirection:o,onSort:e,children:"Timestamp"}),s.jsx(O,{field:"user",sortField:r,sortDirection:o,onSort:e,children:"User"}),s.jsx(O,{field:"action",sortField:r,sortDirection:o,onSort:e,children:"Action"}),s.jsx(O,{field:"resource",sortField:r,sortDirection:o,onSort:e,children:"Resource"}),s.jsx(z,{children:"Details"}),s.jsx(z,{children:"IP Address"})]})}),Oe=({log:r})=>s.jsxs(X,{children:[s.jsx(_,{children:oe(r.timestamp)}),s.jsx(_,{children:r.user}),s.jsx(_,{children:s.jsx(be,{action:r.action,children:r.action})}),s.jsx(_,{children:r.resource}),s.jsx(_,{children:r.details}),s.jsx(_,{children:r.ipAddress})]},r.id),Pe=({logs:r,sortField:o,sortDirection:e,onSort:t})=>r.length===0?s.jsx(de,{children:s.jsx("p",{children:"No audit logs found matching your criteria."})}):s.jsxs(ce,{children:[s.jsx(Me,{sortField:o,sortDirection:e,onSort:t}),s.jsx("tbody",{children:r.map(a=>s.jsx(Oe,{log:a},a.id))})]}),Re=()=>{const[r,o]=S.useState([]),[e,t]=S.useState(!1),[a,n]=S.useState(null),l=async()=>{t(!0),n(null);try{const m=await te.getLogs({page:1,limit:100,sortBy:"timestamp",sortOrder:"desc"});if(m.success){const u=(m.data.logs||[]).map(c=>{var b,y;return{id:c._id,timestamp:c.timestamp,user:c.userEmail||"Unknown",action:c.action,resource:c.resource,resourceId:c.resourceId||"",details:i(c),ipAddress:((b=c.metadata)==null?void 0:b.ipAddress)||"",userAgent:((y=c.metadata)==null?void 0:y.userAgent)||""}});o(u)}else throw new Error(m.message||"Failed to fetch audit logs")}catch(m){console.error("Failed to fetch audit logs:",m),n(m.message),o([])}finally{t(!1)}},i=m=>{const u=m.action.toLowerCase(),c=m.resource.toLowerCase();switch(u){case"create":return`Created new ${c} record`;case"update":return`Updated ${c} record`;case"delete":return`Deleted ${c} record`;case"login":return"User logged in successfully";case"logout":return"User logged out";default:return`Performed ${u} action on ${c}`}};return S.useEffect(()=>{l()},[]),{auditLogs:r,loading:e,error:a,refetchAuditLogs:l}},Ue=r=>{const[o,e]=S.useState(""),[t,a]=S.useState(""),[n,l]=S.useState("timestamp"),[i,m]=S.useState("desc"),u=S.useMemo(()=>r.filter(b=>{const y=o===""||b.user.toLowerCase().includes(o.toLowerCase())||b.details.toLowerCase().includes(o.toLowerCase())||b.resource.toLowerCase().includes(o.toLowerCase()),d=t===""||b.action===t;return y&&d}).sort((b,y)=>{const d=b[n],j=y[n];return i==="asc"?d>j?1:-1:d<j?1:-1}),[r,o,t,n,i]);return{searchTerm:o,setSearchTerm:e,actionFilter:t,setActionFilter:a,sortField:n,sortDirection:i,filteredAndSortedLogs:u,handleSort:b=>{n===b?m(i==="asc"?"desc":"asc"):(l(b),m("desc"))}}},$e=(r,o=se)=>{const[e,t]=S.useState(1),a=Math.ceil(r.length/o),n=(e-1)*o,l=r.slice(n,n+o);return S.useEffect(()=>{t(1)},[r.length]),{currentPage:e,setCurrentPage:t,totalPages:a,startIndex:n,paginatedData:l,pageSize:o}},Be=()=>{const{auditLogs:r,loading:o}=Re(),{searchTerm:e,setSearchTerm:t,actionFilter:a,setActionFilter:n,sortField:l,sortDirection:i,filteredAndSortedLogs:m,handleSort:u}=Ue(r),{currentPage:c,setCurrentPage:b,totalPages:y,startIndex:d,paginatedData:j,pageSize:g}=$e(m,se);return s.jsxs(me,{children:[s.jsxs(he,{children:[s.jsx(fe,{children:"Audit Log"}),s.jsx(Ie,{searchTerm:e,setSearchTerm:t,actionFilter:a,setActionFilter:n})]}),o?s.jsx(q,{text:"Loading audit logs..."}):s.jsx(Pe,{logs:j,sortField:l,sortDirection:i,onSort:u}),s.jsx(ve,{currentPage:c,totalPages:y,startIndex:d,pageSize:g,totalItems:m.length,onPageChange:b})]})},ze=T.header`
  background: ${r=>r.$isDarkMode?"#1f2937":"white"};
  border-bottom: 1px solid ${r=>r.$isDarkMode?"#374151":"#e5e7eb"};
  padding: 1rem 0;
`,He=T.div`
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
`,qe=T.a`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: #10b981;
  color: white;
  text-decoration: none;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.2s;
  
  &:hover {
    background: #059669;
  }
`,We=T.span`
  padding: 0.5rem 1rem;
  background: #fee2e2;
  color: #991b1b;
  border-radius: 9999px;
  font-size: 0.875rem;
  font-weight: 500;
`,Je=T.div`
  display: flex;
  align-items: center;
  gap: 1rem;
`,Ve=T.span`
  font-size: 0.875rem;
  color: ${r=>r.$isDarkMode?"#d1d5db":"#374151"};
`,Ge=T.button`
  color: ${r=>r.$isDarkMode?"#d1d5db":"#374151"};
  background: none;
  border: none;
  padding: 0.5rem;
  border-radius: 0.375rem;
  cursor: pointer;
  transition: color 0.2s;
  
  &:hover {
    color: #10b981;
  }
`,Ke=()=>s.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),Ye=()=>s.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),Ze=()=>{const{user:r,logout:o}=W(),{isDarkMode:e}=U(),t=async()=>{await o()};return s.jsx(ze,{$isDarkMode:e,children:s.jsxs(He,{children:[s.jsxs(qe,{href:"/dashboard",children:[s.jsx(Ke,{}),"Back to Dashboard"]}),s.jsxs(Je,{children:[s.jsx(We,{children:"Admin Panel"}),s.jsx(je,{}),s.jsxs(Ve,{$isDarkMode:e,children:["Welcome, ",s.jsx("strong",{children:r==null?void 0:r.name})]}),s.jsx(Ge,{onClick:t,"aria-label":"Logout",$isDarkMode:e,children:s.jsx(Ye,{})})]})]})})},Qe=T.div`
  background: ${r=>r.$isDarkMode?"#1f2937":"white"};
  padding: 1.5rem;
  border-radius: 0.75rem;
  border: 1px solid ${r=>r.$isDarkMode?"#374151":"#e5e7eb"};
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, ${r=>r.$isDarkMode?"0.3":"0.1"});
`,Xe=T.div`
  font-size: 2rem;
  font-weight: 700;
  color: ${r=>r.$isDarkMode?"#f9fafb":"#111827"};
  margin-bottom: 0.5rem;
`,et=T.div`
  font-size: 0.875rem;
  color: ${r=>r.$isDarkMode?"#9ca3af":"#6b7280"};
  font-weight: 500;
`,tt=T.div`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 3rem;
  height: 3rem;
  border-radius: 0.75rem;
  margin-bottom: 1rem;
  
  ${r=>{switch(r.type){case"users":return"background: #dbeafe; color: #1e40af;";case"actions":return"background: #d1fae5; color: #065f46;";case"errors":return"background: #fee2e2; color: #991b1b;";case"activity":return"background: #fef3c7; color: #92400e;";default:return"background: #f3f4f6; color: #374151;"}}}
`,rt=({icon:r,value:o,label:e,type:t})=>{const{isDarkMode:a}=U();return s.jsxs(Qe,{$isDarkMode:a,children:[s.jsx(tt,{type:t,children:r}),s.jsx(Xe,{$isDarkMode:a,children:o}),s.jsx(et,{$isDarkMode:a,children:e})]})},st=()=>{const[r,o]=S.useState({activeUsers:0,totalActions:0,failedActions:0,systemUptime:0}),[e,t]=S.useState(!1),[a,n]=S.useState(null),l=async()=>{t(!0),n(null);try{const i=await te.getLogs({days:1,page:1,limit:1e3});if(i.success){const m=i.data.logs||[],u=new Set(m.map(j=>j.userEmail)).size,c=m.length,b=m.filter(j=>{var g,h;return((g=j.metadata)==null?void 0:g.statusCode)>=400||((h=j.metadata)==null?void 0:h.errorMessage)}).length,y=m.filter(j=>{var g;return((g=j.metadata)==null?void 0:g.statusCode)>=500}).length,d=Math.max(95,100-y/c*100);o({activeUsers:u,totalActions:c,failedActions:b,systemUptime:d.toFixed(1)})}}catch(i){console.error("Failed to fetch admin stats:",i),n(i.message),o({activeUsers:0,totalActions:0,failedActions:0,systemUptime:"99.9"})}finally{t(!1)}};return S.useEffect(()=>{l()},[]),{stats:r,loading:e,error:a,refetch:l}},at=T.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
`,nt=()=>s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),ot=()=>s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),it=()=>s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),lt=()=>s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),dt=()=>{const{stats:r,loading:o,error:e}=st();if(o)return s.jsx(q,{text:"Loading statistics..."});e&&console.error("Admin stats error:",e);const t=[{icon:s.jsx(nt,{}),value:r.activeUsers.toString(),label:"Active Users Today",type:"users"},{icon:s.jsx(ot,{}),value:r.totalActions.toLocaleString(),label:"Total Actions Today",type:"actions"},{icon:s.jsx(it,{}),value:r.failedActions.toString(),label:"Failed Actions",type:"errors"},{icon:s.jsx(lt,{}),value:`${r.systemUptime}%`,label:"System Uptime",type:"activity"}];return s.jsx(at,{children:t.map((a,n)=>s.jsx(rt,{icon:a.icon,value:a.value,label:a.label,type:a.type},n))})},ct={},Y=r=>{let o;const e=new Set,t=(c,b)=>{const y=typeof c=="function"?c(o):c;if(!Object.is(y,o)){const d=o;o=b??(typeof y!="object"||y===null)?y:Object.assign({},o,y),e.forEach(j=>j(o,d))}},a=()=>o,m={setState:t,getState:a,getInitialState:()=>u,subscribe:c=>(e.add(c),()=>e.delete(c)),destroy:()=>{(ct?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),e.clear()}},u=o=r(t,a,m);return m},ut=r=>r?Y(r):Y,ae={},{useDebugValue:gt}=ie,{useSyncExternalStoreWithSelector:mt}=Se;let Z=!1;const ht=r=>r;function ft(r,o=ht,e){(ae?"production":void 0)!=="production"&&e&&!Z&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Z=!0);const t=mt(r.subscribe,r.getState,r.getServerState||r.getInitialState,o,e);return gt(t),t}const Q=r=>{(ae?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const o=typeof r=="function"?ut(r):r,e=(t,a)=>ft(o,t,a);return Object.assign(e,o),e},I=r=>r?Q(r):Q,R={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_TIMEOUT:"10000",VITE_API_URL:"https://project-final-frontend-4bia.onrender.com/api",VITE_ENABLE_ANALYTICS:"false",VITE_ENABLE_DARK_MODE:"true",VITE_ENV:"development",VITE_MAP_API_KEY:"your_map_api_key_here",VITE_MAP_TILE_URL:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",VITE_SENTRY_DSN:"your_sentry_dsn_here"},H=new Map,P=r=>{const o=H.get(r);return o?Object.fromEntries(Object.entries(o.stores).map(([e,t])=>[e,t.getState()])):{}},pt=(r,o,e)=>{if(r===void 0)return{type:"untracked",connection:o.connect(e)};const t=H.get(e.name);if(t)return{type:"tracked",store:r,...t};const a={connection:o.connect(e),stores:{}};return H.set(e.name,a),{type:"tracked",store:r,...a}},xt=(r,o={})=>(e,t,a)=>{const{enabled:n,anonymousActionType:l,store:i,...m}=o;let u;try{u=(n??(R?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!u)return(R?"production":void 0)!=="production"&&n&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),r(e,t,a);const{connection:c,...b}=pt(i,u,m);let y=!0;a.setState=(g,h,x)=>{const p=e(g,h);if(!y)return p;const v=x===void 0?{type:l||"anonymous"}:typeof x=="string"?{type:x}:x;return i===void 0?(c==null||c.send(v,t()),p):(c==null||c.send({...v,type:`${i}/${v.type}`},{...P(m.name),[i]:a.getState()}),p)};const d=(...g)=>{const h=y;y=!1,e(...g),y=h},j=r(a.setState,t,a);if(b.type==="untracked"?c==null||c.init(j):(b.stores[b.store]=a,c==null||c.init(Object.fromEntries(Object.entries(b.stores).map(([g,h])=>[g,g===b.store?j:h.getState()])))),a.dispatchFromDevtools&&typeof a.dispatch=="function"){let g=!1;const h=a.dispatch;a.dispatch=(...x)=>{(R?"production":void 0)!=="production"&&x[0].type==="__setState"&&!g&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),g=!0),h(...x)}}return c.subscribe(g=>{var h;switch(g.type){case"ACTION":if(typeof g.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return B(g.payload,x=>{if(x.type==="__setState"){if(i===void 0){d(x.state);return}Object.keys(x.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const p=x.state[i];if(p==null)return;JSON.stringify(a.getState())!==JSON.stringify(p)&&d(p);return}a.dispatchFromDevtools&&typeof a.dispatch=="function"&&a.dispatch(x)});case"DISPATCH":switch(g.payload.type){case"RESET":return d(j),i===void 0?c==null?void 0:c.init(a.getState()):c==null?void 0:c.init(P(m.name));case"COMMIT":if(i===void 0){c==null||c.init(a.getState());return}return c==null?void 0:c.init(P(m.name));case"ROLLBACK":return B(g.state,x=>{if(i===void 0){d(x),c==null||c.init(a.getState());return}d(x[i]),c==null||c.init(P(m.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return B(g.state,x=>{if(i===void 0){d(x);return}JSON.stringify(a.getState())!==JSON.stringify(x[i])&&d(x[i])});case"IMPORT_STATE":{const{nextLiftedState:x}=g.payload,p=(h=x.computedStates.slice(-1)[0])==null?void 0:h.state;if(!p)return;d(i===void 0?p:p[i]),c==null||c.send(null,x);return}case"PAUSE_RECORDING":return y=!y}return}}),j},L=xt,B=(r,o)=>{let e;try{e=JSON.parse(r)}catch(t){console.error("[zustand devtools middleware] Could not parse the received json",t)}e!==void 0&&o(e)};function yt(r,o){let e;try{e=r()}catch{return}return{getItem:a=>{var n;const l=m=>m===null?null:JSON.parse(m,void 0),i=(n=e.getItem(a))!=null?n:null;return i instanceof Promise?i.then(l):l(i)},setItem:(a,n)=>e.setItem(a,JSON.stringify(n,void 0)),removeItem:a=>e.removeItem(a)}}const M=r=>o=>{try{const e=r(o);return e instanceof Promise?e:{then(t){return M(t)(e)},catch(t){return this}}}catch(e){return{then(t){return this},catch(t){return M(t)(e)}}}},bt=(r,o)=>(e,t,a)=>{let n={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:h=>h,version:0,merge:(h,x)=>({...x,...h}),...o},l=!1;const i=new Set,m=new Set;let u;try{u=n.getStorage()}catch{}if(!u)return r((...h)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),e(...h)},t,a);const c=M(n.serialize),b=()=>{const h=n.partialize({...t()});let x;const p=c({state:h,version:n.version}).then(v=>u.setItem(n.name,v)).catch(v=>{x=v});if(x)throw x;return p},y=a.setState;a.setState=(h,x)=>{y(h,x),b()};const d=r((...h)=>{e(...h),b()},t,a);let j;const g=()=>{var h;if(!u)return;l=!1,i.forEach(p=>p(t()));const x=((h=n.onRehydrateStorage)==null?void 0:h.call(n,t()))||void 0;return M(u.getItem.bind(u))(n.name).then(p=>{if(p)return n.deserialize(p)}).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==n.version){if(n.migrate)return n.migrate(p.state,p.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return p.state}).then(p=>{var v;return j=n.merge(p,(v=t())!=null?v:d),e(j,!0),b()}).then(()=>{x==null||x(j,void 0),l=!0,m.forEach(p=>p(j))}).catch(p=>{x==null||x(void 0,p)})};return a.persist={setOptions:h=>{n={...n,...h},h.getStorage&&(u=h.getStorage())},clearStorage:()=>{u==null||u.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>g(),hasHydrated:()=>l,onHydrate:h=>(i.add(h),()=>{i.delete(h)}),onFinishHydration:h=>(m.add(h),()=>{m.delete(h)})},g(),j||d},vt=(r,o)=>(e,t,a)=>{let n={storage:yt(()=>localStorage),partialize:g=>g,version:0,merge:(g,h)=>({...h,...g}),...o},l=!1;const i=new Set,m=new Set;let u=n.storage;if(!u)return r((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),e(...g)},t,a);const c=()=>{const g=n.partialize({...t()});return u.setItem(n.name,{state:g,version:n.version})},b=a.setState;a.setState=(g,h)=>{b(g,h),c()};const y=r((...g)=>{e(...g),c()},t,a);a.getInitialState=()=>y;let d;const j=()=>{var g,h;if(!u)return;l=!1,i.forEach(p=>{var v;return p((v=t())!=null?v:y)});const x=((h=n.onRehydrateStorage)==null?void 0:h.call(n,(g=t())!=null?g:y))||void 0;return M(u.getItem.bind(u))(n.name).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==n.version){if(n.migrate)return[!0,n.migrate(p.state,p.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,p.state];return[!1,void 0]}).then(p=>{var v;const[E,f]=p;if(d=n.merge(f,(v=t())!=null?v:y),e(d,!0),E)return c()}).then(()=>{x==null||x(d,void 0),d=t(),l=!0,m.forEach(p=>p(d))}).catch(p=>{x==null||x(void 0,p)})};return a.persist={setOptions:g=>{n={...n,...g},g.storage&&(u=g.storage)},clearStorage:()=>{u==null||u.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>j(),hasHydrated:()=>l,onHydrate:g=>(i.add(g),()=>{i.delete(g)}),onFinishHydration:g=>(m.add(g),()=>{m.delete(g)})},n.skipHydration||j(),d||y},jt=(r,o)=>"getStorage"in o||"serialize"in o||"deserialize"in o?((R?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),bt(r,o)):vt(r,o),ne=jt;I(L(ne((r,o)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,login:(e,t)=>{localStorage.setItem("authToken",t),r({user:e,token:t,isAuthenticated:!0,isLoading:!1})},logout:()=>{localStorage.removeItem("authToken"),r({user:null,token:null,isAuthenticated:!1,isLoading:!1})},setLoading:e=>r({isLoading:e}),updateUser:e=>r({user:e})}),{name:"auth-storage",partialize:r=>({user:r.user,token:r.token,isAuthenticated:r.isAuthenticated})}),{name:"auth-store"}));const St=I(L(ne((r,o)=>({filters:{dateRange:{start:null,end:null},forests:[],regions:[],species:[],status:"all",soilCondition:"",sunlightExposure:"",search:""},setFilters:e=>r(t=>({filters:{...t.filters,...e}})),clearFilters:()=>r({filters:{dateRange:{start:null,end:null},forests:[],regions:[],species:[],status:"all",soilCondition:"",sunlightExposure:"",search:""}}),setDateRange:e=>r(t=>({filters:{...t.filters,dateRange:e}})),setForestFilter:e=>r(t=>({filters:{...t.filters,forests:e}})),setRegionFilter:e=>r(t=>({filters:{...t.filters,regions:e}})),setSpeciesFilter:e=>r(t=>({filters:{...t.filters,species:e}})),setStatusFilter:e=>r(t=>({filters:{...t.filters,status:e}})),setSoilConditionFilter:e=>r(t=>({filters:{...t.filters,soilCondition:e}})),setSunlightExposureFilter:e=>r(t=>({filters:{...t.filters,sunlightExposure:e}})),setSearchFilter:e=>r(t=>({filters:{...t.filters,search:e}})),getActiveFiltersCount:()=>{const{filters:e}=o();let t=0;return(e.dateRange.start||e.dateRange.end)&&t++,e.forests.length>0&&t++,e.regions.length>0&&t++,e.species.length>0&&t++,e.status!=="all"&&t++,e.soilCondition&&t++,e.sunlightExposure&&t++,e.search.trim()&&t++,t},hasActiveFilters:()=>o().getActiveFiltersCount()>0,getApiParams:()=>{const{filters:e}=o(),t={};return e.dateRange.start&&(t.startDate=e.dateRange.start),e.dateRange.end&&(t.endDate=e.dateRange.end),e.forests.length>0&&(t.forestIds=e.forests.join(",")),e.regions.length>0&&(t.regions=e.regions.join(",")),e.species.length>0&&(t.species=e.species.join(",")),e.status!=="all"&&(t.status=e.status),e.soilCondition&&(t.soilCondition=e.soilCondition),e.sunlightExposure&&(t.sunlightExposure=e.sunlightExposure),e.search.trim()&&(t.search=e.search.trim()),t}}),{name:"filters-storage",partialize:r=>({filters:r.filters})}),{name:"filters-store"}));I(L((r,o)=>({sidebarOpen:!1,darkMode:!1,setSidebarOpen:e=>r({sidebarOpen:e}),toggleSidebar:()=>r(e=>({sidebarOpen:!e.sidebarOpen})),setDarkMode:e=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),r({darkMode:e})},toggleDarkMode:()=>{const e=!o().darkMode;e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),r({darkMode:e})}}),{name:"ui-store"}));I(L((r,o)=>({forests:[],trees:[],loading:!1,error:null,lastFetch:{forests:null,trees:null},setForests:e=>r({forests:e,lastFetch:{...o().lastFetch,forests:Date.now()}}),setTrees:e=>r({trees:e,lastFetch:{...o().lastFetch,trees:Date.now()}}),setLoading:e=>r({loading:e}),setError:e=>r({error:e}),clearError:()=>r({error:null}),fetchForests:async(e=!1)=>{var l;const t=o(),n=Date.now()-(t.lastFetch.forests||0)<5*60*1e3;if(!e&&t.forests.length>0&&n)return t.forests;r({loading:!0,error:null});try{const i=await N.getAll(),m=((l=i.data)==null?void 0:l.forests)||i.data||[];return r({forests:m,loading:!1,lastFetch:{...t.lastFetch,forests:Date.now()}}),m}catch(i){throw r({error:i.message,loading:!1}),i}},fetchTrees:async(e={},t=!1)=>{var i;const a=o(),l=Date.now()-(a.lastFetch.trees||0)<5*60*1e3;if(!t&&a.trees.length>0&&l&&Object.keys(e).length===0)return a.trees;r({loading:!0,error:null});try{const m=await F.getAll(e),u=((i=m.data)==null?void 0:i.trees)||m.data||[];return r({trees:u,loading:!1,lastFetch:{...a.lastFetch,trees:Date.now()}}),u}catch(m){throw r({error:m.message,loading:!1}),m}},addForest:e=>r(t=>({forests:[...t.forests,e]})),updateForest:(e,t)=>r(a=>({forests:a.forests.map(n=>(n._id||n.id)===e?{...n,...t}:n)})),removeForest:e=>r(t=>({forests:t.forests.filter(a=>(a._id||a.id)!==e)})),addTree:e=>r(t=>({trees:[...t.trees,e]})),updateTree:(e,t)=>r(a=>({trees:a.trees.map(n=>(n._id||n.id)===e?{...n,...t}:n)})),removeTree:e=>r(t=>({trees:t.trees.filter(a=>(a._id||a.id)!==e)})),getForestById:e=>o().forests.find(t=>(t._id||t.id)===e),getTreeById:e=>o().trees.find(t=>(t._id||t.id)===e),getTreesByForest:e=>o().trees.filter(t=>{var n;return(((n=t.forestId)==null?void 0:n._id)||t.forestId)===e}),clearCache:()=>r({lastFetch:{forests:null,trees:null}}),reset:()=>r({forests:[],trees:[],loading:!1,error:null,lastFetch:{forests:null,trees:null}})}),{name:"data-store"}));const wt=I(L((r,o)=>({trees:[],selectedTree:null,loading:!1,error:null,pagination:{page:1,limit:20,total:0,totalPages:0},measurements:{},setTrees:e=>r({trees:e}),setSelectedTree:e=>r({selectedTree:e}),setLoading:e=>r({loading:e}),setError:e=>r({error:e}),clearError:()=>r({error:null}),setPagination:e=>r({pagination:e}),createTree:async e=>{r({loading:!0,error:null});try{const a=(await F.create(e)).data;return r(n=>({trees:[a,...n.trees],loading:!1})),a}catch(t){throw r({error:t.message,loading:!1}),t}},updateTree:async(e,t)=>{r({loading:!0,error:null});try{const n=(await F.update(e,t)).data;return r(l=>({trees:l.trees.map(i=>(i._id||i.id)===e?n:i),selectedTree:l.selectedTree&&(l.selectedTree._id||l.selectedTree.id)===e?n:l.selectedTree,loading:!1})),n}catch(a){throw r({error:a.message,loading:!1}),a}},deleteTree:async e=>{r({loading:!0,error:null});try{await F.delete(e),r(t=>({trees:t.trees.filter(a=>(a._id||a.id)!==e),selectedTree:t.selectedTree&&(t.selectedTree._id||t.selectedTree.id)===e?null:t.selectedTree,loading:!1}))}catch(t){throw r({error:t.message,loading:!1}),t}},markTreeDead:async(e,t)=>{r({loading:!0,error:null});try{const n=(await F.markDead(e,{reason:t})).data;return r(l=>({trees:l.trees.map(i=>(i._id||i.id)===e?n:i),selectedTree:l.selectedTree&&(l.selectedTree._id||l.selectedTree.id)===e?n:l.selectedTree,loading:!1})),n}catch(a){throw r({error:a.message,loading:!1}),a}},addMeasurement:async(e,t)=>{r({loading:!0,error:null});try{const n=(await F.addMeasurement(e,t)).data;return r(l=>({trees:l.trees.map(i=>(i._id||i.id)===e?n:i),selectedTree:l.selectedTree&&(l.selectedTree._id||l.selectedTree.id)===e?n:l.selectedTree,loading:!1})),n}catch(a){throw r({error:a.message,loading:!1}),a}},fetchTreeMeasurements:async(e,t=!1)=>{const a=o();if(!t&&a.measurements[e])return a.measurements[e];r({loading:!0,error:null});try{const l=(await F.getMeasurements(e)).data;return r(i=>({measurements:{...i.measurements,[e]:l},loading:!1})),l}catch(n){throw r({error:n.message,loading:!1}),n}},fetchTrees:async(e={})=>{r({loading:!0,error:null});try{const t=await F.getAll({page:e.page||o().pagination.page,limit:e.limit||o().pagination.limit,...e}),{trees:a,pagination:n}=t.data;return r({trees:a||[],pagination:n||o().pagination,loading:!1}),{trees:a,pagination:n}}catch(t){throw r({error:t.message,loading:!1}),t}},getTreeById:e=>o().trees.find(t=>(t._id||t.id)===e),getTreesByForest:e=>o().trees.filter(t=>{var n;return(((n=t.forestId)==null?void 0:n._id)||t.forestId)===e}),getTreesByStatus:e=>{if(e==="all")return o().trees;const t=e==="alive";return o().trees.filter(a=>a.status===(t?"alive":"dead"))},getTreesBySpecies:e=>!e||e.length===0?o().trees:o().trees.filter(t=>e.includes(t.species)),searchTrees:e=>{if(!e.trim())return o().trees;const t=e.toLowerCase();return o().trees.filter(a=>{var n;return a.treeId.toLowerCase().includes(t)||a.species.toLowerCase().includes(t)||((n=a.metadata)==null?void 0:n.notes)&&a.metadata.notes.toLowerCase().includes(t)})},getTreeStats:()=>{const e=o().trees,t=e.filter(i=>i.status==="alive").length,a=e.filter(i=>i.status==="dead").length,n=e.length,l=e.reduce((i,m)=>(i[m.species]=(i[m.species]||0)+1,i),{});return{total:n,alive:t,dead:a,survivalRate:n>0?t/n*100:0,speciesCount:l}},reset:()=>r({trees:[],selectedTree:null,loading:!1,error:null,pagination:{page:1,limit:20,total:0,totalPages:0},measurements:{}})}),{name:"tree-store"}));I(L((r,o)=>({forests:[],selectedForest:null,loading:!1,error:null,analytics:{},setForests:e=>r({forests:e}),setSelectedForest:e=>r({selectedForest:e}),setLoading:e=>r({loading:e}),setError:e=>r({error:e}),clearError:()=>r({error:null}),createForest:async e=>{r({loading:!0,error:null});try{const a=(await N.create(e)).data;return r(n=>({forests:[a,...n.forests],loading:!1})),a}catch(t){throw r({error:t.message,loading:!1}),t}},updateForest:async(e,t)=>{r({loading:!0,error:null});try{const n=(await N.update(e,t)).data;return r(l=>({forests:l.forests.map(i=>(i._id||i.id)===e?n:i),selectedForest:l.selectedForest&&(l.selectedForest._id||l.selectedForest.id)===e?n:l.selectedForest,loading:!1})),n}catch(a){throw r({error:a.message,loading:!1}),a}},deleteForest:async e=>{r({loading:!0,error:null});try{await N.delete(e),r(t=>({forests:t.forests.filter(a=>(a._id||a.id)!==e),selectedForest:t.selectedForest&&(t.selectedForest._id||t.selectedForest.id)===e?null:t.selectedForest,loading:!1}))}catch(t){throw r({error:t.message,loading:!1}),t}},fetchForests:async(e={})=>{var t;r({loading:!0,error:null});try{const a=await N.getAll(e),n=((t=a.data)==null?void 0:t.forests)||a.data||[];return r({forests:n,loading:!1}),n}catch(a){throw r({error:a.message,loading:!1}),a}},fetchForestById:async e=>{r({loading:!0,error:null});try{const a=(await N.getById(e)).data;return r(n=>({selectedForest:a,forests:n.forests.map(l=>(l._id||l.id)===e?a:l),loading:!1})),a}catch(t){throw r({error:t.message,loading:!1}),t}},fetchForestAnalytics:async(e,t=!1)=>{const a=o();if(!t&&a.analytics[e])return a.analytics[e];r({loading:!0,error:null});try{const l=(await N.getAnalytics(e)).data;return r(i=>({analytics:{...i.analytics,[e]:l},loading:!1})),l}catch(n){throw r({error:n.message,loading:!1}),n}},getForestById:e=>o().forests.find(t=>(t._id||t.id)===e),getForestsByRegion:e=>e?o().forests.filter(t=>t.region===e):o().forests,searchForests:e=>{if(!e.trim())return o().forests;const t=e.toLowerCase();return o().forests.filter(a=>a.name.toLowerCase().includes(t)||a.region.toLowerCase().includes(t)||a.description&&a.description.toLowerCase().includes(t))},getRegions:()=>{const e=o().forests;return[...new Set(e.map(t=>t.region).filter(Boolean))]},getForestStats:()=>{const e=o().forests,t=e.length,a=e.reduce((l,i)=>l+(i.area||0),0),n=e.reduce((l,i)=>(i.region&&(l[i.region]=(l[i.region]||0)+1),l),{});return{total:t,totalArea:a,regionCount:n,averageArea:t>0?a/t:0}},getForestOptions:()=>o().forests.map(e=>({value:e._id||e.id,label:e.name})),reset:()=>r({forests:[],selectedForest:null,loading:!1,error:null,analytics:{}})}),{name:"forest-store"}));delete re.Icon.Default.prototype._getIconUrl;re.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const kt=({position:r,setPosition:o})=>{const e=Fe({click(t){const a=[t.latlng.lat,t.latlng.lng];o(a),e.flyTo(t.latlng,e.getZoom())}});return r===null?null:s.jsx(Ne,{position:r})},Tt=({latitude:r,longitude:o,onLocationChange:e,height:t="300px",className:a=""})=>{const[n,l]=S.useState(null);S.useEffect(()=>{r&&o&&!isNaN(parseFloat(r))&&!isNaN(parseFloat(o))&&l([parseFloat(r),parseFloat(o)])},[r,o]),S.useEffect(()=>{n&&e&&e({latitude:n[0].toString(),longitude:n[1].toString()})},[n,e]);const i=(c,b)=>{const y=parseFloat(c),d=parseFloat(b);!isNaN(y)&&!isNaN(d)&&y>=-90&&y<=90&&d>=-180&&d<=180&&l([y,d])},u=n||[59.3293,18.0686];return s.jsxs("div",{className:a,children:[s.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Latitude"}),s.jsx("input",{type:"number",step:"any",value:n?n[0]:r||"",onChange:c=>i(c.target.value,n?n[1]:o),className:"form-input w-full",placeholder:"e.g., 59.3293"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Longitude"}),s.jsx("input",{type:"number",step:"any",value:n?n[1]:o||"",onChange:c=>i(n?n[0]:r,c.target.value),className:"form-input w-full",placeholder:"e.g., 18.0686"})]})]}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Click on the map to set the tree location, or enter coordinates manually above."}),s.jsx("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",style:{height:t},children:s.jsxs(Ce,{center:u,zoom:n?15:10,style:{height:"100%",width:"100%"},children:[s.jsx(Ae,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),s.jsx(kt,{position:n,setPosition:l})]},u.join(","))}),n&&s.jsx("div",{className:"mt-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:s.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[s.jsx("strong",{children:"Selected Location:"})," ",n[0].toFixed(6),", ",n[1].toFixed(6)]})})]})},Et=({isOpen:r,onClose:o,tree:e=null,onSuccess:t})=>{const{user:a}=W(),[n,l]=S.useState([]),[i,m]=S.useState(!1),[u,c]=S.useState({}),[b,y]=S.useState(!1),[d,j]=S.useState({treeId:"",forestId:"",species:"",plantedDate:"",latitude:"",longitude:"",soilCondition:"",sunlightExposure:"",notes:""}),g=!!e;S.useEffect(()=>{r&&(async()=>{var w;try{const k=await N.getAll(),C=((w=k.data)==null?void 0:w.forests)||k.data||[];l(C)}catch(k){console.error("Failed to load forests:",k)}})()},[r]),S.useEffect(()=>{var f,w,k,C,J,V,G,K;j(e?{treeId:e.treeId||"",forestId:((f=e.forestId)==null?void 0:f._id)||e.forestId||"",species:e.species||"",plantedDate:e.plantedDate?new Date(e.plantedDate).toISOString().split("T")[0]:"",latitude:((k=(w=e.location)==null?void 0:w.coordinates)==null?void 0:k[1])||e.lat||"",longitude:((J=(C=e.location)==null?void 0:C.coordinates)==null?void 0:J[0])||e.lng||"",soilCondition:((V=e.metadata)==null?void 0:V.soilCondition)||"",sunlightExposure:((G=e.metadata)==null?void 0:G.sunlightExposure)||"",notes:((K=e.metadata)==null?void 0:K.notes)||""}:{treeId:"",forestId:"",species:"",plantedDate:"",latitude:"",longitude:"",soilCondition:"",sunlightExposure:"",notes:""}),c({})},[e]);const h=(f,w)=>{j(k=>({...k,[f]:w})),u[f]&&c(k=>({...k,[f]:null}))},x=({latitude:f,longitude:w})=>{j(k=>({...k,latitude:f,longitude:w})),c(k=>({...k,latitude:null,longitude:null}))},p=()=>{const f={};if(d.treeId.trim()||(f.treeId="Tree ID is required"),d.forestId||(f.forestId="Forest is required"),d.species.trim()||(f.species="Species is required"),d.plantedDate||(f.plantedDate="Planted date is required"),!d.latitude||isNaN(parseFloat(d.latitude)))f.latitude="Valid latitude is required";else{const w=parseFloat(d.latitude);(w<-90||w>90)&&(f.latitude="Latitude must be between -90 and 90")}if(!d.longitude||isNaN(parseFloat(d.longitude)))f.longitude="Valid longitude is required";else{const w=parseFloat(d.longitude);(w<-180||w>180)&&(f.longitude="Longitude must be between -180 and 180")}return c(f),Object.keys(f).length===0},v=async f=>{var w,k;if(f.preventDefault(),!!p()){m(!0);try{const C={treeId:d.treeId,forestId:d.forestId,species:d.species,plantedDate:d.plantedDate,location:{type:"Point",coordinates:[parseFloat(d.longitude),parseFloat(d.latitude)]},metadata:{soilCondition:d.soilCondition||void 0,sunlightExposure:d.sunlightExposure||void 0,notes:d.notes||void 0}};g?await F.update(e._id,C):await F.create(C),t==null||t(),o()}catch(C){console.error("Failed to save tree:",C),c({submit:((k=(w=C.response)==null?void 0:w.data)==null?void 0:k.message)||`Failed to ${g?"update":"create"} tree`})}finally{m(!1)}}},E=[{value:"",label:"Select sunlight exposure"},{value:"full_sun",label:"Full Sun"},{value:"partial_sun",label:"Partial Sun"},{value:"partial_shade",label:"Partial Shade"},{value:"full_shade",label:"Full Shade"}];return s.jsx(pe,{isOpen:r,onClose:o,title:`${g?"Edit":"Create"} Tree`,children:s.jsxs("form",{onSubmit:v,className:"space-y-6",children:[u.submit&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:u.submit}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(A,{label:"Tree ID",required:!0,error:u.treeId,children:s.jsx("input",{type:"text",value:d.treeId,onChange:f=>h("treeId",f.target.value),className:"form-input",placeholder:"e.g., TREE-001",disabled:i})}),s.jsx(A,{label:"Forest",required:!0,error:u.forestId,children:s.jsxs("select",{value:d.forestId,onChange:f=>h("forestId",f.target.value),className:"form-input",disabled:i,children:[s.jsx("option",{value:"",children:"Select a forest"}),n.map(f=>s.jsx("option",{value:f._id,children:f.name},f._id))]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(A,{label:"Species",required:!0,error:u.species,children:s.jsx("input",{type:"text",value:d.species,onChange:f=>h("species",f.target.value),className:"form-input",placeholder:"e.g., Pine, Oak, Birch",disabled:i})}),s.jsx(A,{label:"Planted Date",required:!0,error:u.plantedDate,children:s.jsx("input",{type:"date",value:d.plantedDate,onChange:f=>h("plantedDate",f.target.value),className:"form-input",disabled:i})})]}),s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h4",{className:"text-md font-medium text-gray-900 dark:text-white",children:"Tree Location"}),s.jsx("button",{type:"button",onClick:()=>y(!b),className:"text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 font-medium",disabled:i,children:b?"Use Manual Entry":"Use Map Picker"})]}),b?s.jsx(A,{label:"Select Location on Map",required:!0,error:u.latitude||u.longitude,children:s.jsx(Tt,{latitude:d.latitude,longitude:d.longitude,onLocationChange:x,height:"400px"})}):s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(A,{label:"Latitude",required:!0,error:u.latitude,helpText:"Between -90 and 90 degrees",children:s.jsx("input",{type:"number",step:"any",value:d.latitude,onChange:f=>h("latitude",f.target.value),className:"form-input",placeholder:"e.g., 59.3293",disabled:i})}),s.jsx(A,{label:"Longitude",required:!0,error:u.longitude,helpText:"Between -180 and 180 degrees",children:s.jsx("input",{type:"number",step:"any",value:d.longitude,onChange:f=>h("longitude",f.target.value),className:"form-input",placeholder:"e.g., 18.0686",disabled:i})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(A,{label:"Soil Condition",error:u.soilCondition,children:s.jsx("input",{type:"text",value:d.soilCondition,onChange:f=>h("soilCondition",f.target.value),className:"form-input",placeholder:"e.g., Sandy, Clay, Loamy",disabled:i})}),s.jsx(A,{label:"Sunlight Exposure",error:u.sunlightExposure,children:s.jsx("select",{value:d.sunlightExposure,onChange:f=>h("sunlightExposure",f.target.value),className:"form-input",disabled:i,children:E.map(f=>s.jsx("option",{value:f.value,children:f.label},f.value))})})]}),s.jsx(A,{label:"Notes",error:u.notes,children:s.jsx("textarea",{value:d.notes,onChange:f=>h("notes",f.target.value),className:"form-input resize-none",rows:"3",placeholder:"Additional notes about the tree...",disabled:i})}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",disabled:i,children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",disabled:i,children:i?"Saving...":g?"Update Tree":"Create Tree"})]})]})})},Ct=()=>{const{trees:r,loading:o,error:e,pagination:t,selectedTree:a,fetchTrees:n,deleteTree:l,setSelectedTree:i}=wt(),{setSearchFilter:m}=St(),[u,c]=S.useState(""),[b,y]=S.useState(!1),d=async(v="",E=1)=>{try{await n({page:E,limit:10,search:v})}catch(f){console.error("Failed to load trees:",f)}};S.useEffect(()=>{d(u,t.page)},[u,t.page]);const j=()=>{i(null),y(!0)},g=v=>{i(v),y(!0)},h=async v=>{if(window.confirm("Are you sure you want to delete this tree?"))try{await l(v)}catch(E){console.error("Failed to delete tree:",E),alert("Failed to delete tree. Please try again.")}},x=()=>{d(u,t.page)},p=v=>{const E=v.target.value;c(E),m(E),d(E,1)};return o&&r.length===0?s.jsx("div",{className:"flex justify-center items-center py-12",children:s.jsx(q,{text:"Loading trees..."})}):s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[s.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Tree Management"}),s.jsx("button",{onClick:j,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Add Tree"})]}),s.jsx(ee,{type:"text",placeholder:"Search trees by ID or species...",value:u,onChange:p})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Tree ID"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Species"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Forest"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Location"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:r.map(v=>{var E,f;return s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-900",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:v.treeId}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:v.species}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:((E=v.forestId)==null?void 0:E.name)||"Unknown"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:(f=v.location)!=null&&f.coordinates?`${v.location.coordinates[1].toFixed(4)}, ${v.location.coordinates[0].toFixed(4)}`:"No location"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${v.isAlive?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"}`,children:v.isAlive?"Alive":"Dead"})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>g(v),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:"Edit"}),s.jsx("button",{onClick:()=>h(v._id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Delete"})]})})]},v._id)})})]})}),r.length===0&&!o&&s.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:u?"No trees found matching your search.":"No trees found."}),t.totalPages>1&&s.jsx("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Page ",t.page," of ",t.totalPages]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>d(u,Math.max(1,t.page-1)),disabled:t.page===1,className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded disabled:opacity-50",children:"Previous"}),s.jsx("button",{onClick:()=>d(u,Math.min(t.totalPages,t.page+1)),disabled:t.page===t.totalPages,className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded disabled:opacity-50",children:"Next"})]})]})}),s.jsx(Et,{isOpen:b,onClose:()=>y(!1),tree:a,onSuccess:x})]})},At=T.div`
  min-height: 100vh;
  background-color: ${r=>r.$isDarkMode?"#111827":"#f9fafb"};
`,Ft=T.main`
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
`,Nt=T.div`
  margin-bottom: 2rem;
`,_t=T.h1`
  font-size: 2.5rem;
  font-weight: 700;
  color: ${r=>r.$isDarkMode?"#f9fafb":"#111827"};
  margin: 0 0 1rem 0;
`,It=T.p`
  color: ${r=>r.$isDarkMode?"#9ca3af":"#6b7280"};
  font-size: 1.125rem;
  margin: 0;
`,Lt=({children:r})=>{const{isDarkMode:o}=U();return s.jsx(At,{$isDarkMode:o,children:r})},Dt=({title:r,description:o})=>{const{isDarkMode:e}=U();return s.jsxs(Nt,{children:[s.jsx(_t,{$isDarkMode:e,children:r}),s.jsx(It,{$isDarkMode:e,children:o})]})},Mt=({children:r})=>s.jsx(Ft,{children:r}),Gt=()=>{const{isAdmin:r}=W(),[o,e]=S.useState("audit");if(!r())return s.jsx(le,{to:"/dashboard",replace:!0});const t=[{id:"audit",label:"Audit Logs"},{id:"trees",label:"Tree Management"}],a=()=>{switch(o){case"trees":return s.jsx(Ct,{});case"audit":default:return s.jsx(Be,{})}};return s.jsxs(Lt,{children:[s.jsx(Ze,{}),s.jsxs(Mt,{children:[s.jsx(Dt,{title:"System Administration",description:"Monitor system activity, manage trees, and view comprehensive audit logging."}),s.jsx(dt,{}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow mb-6",children:[s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:s.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:t.map(n=>s.jsx("button",{onClick:()=>e(n.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${o===n.id?"border-green-500 text-green-600 dark:text-green-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300"}`,children:n.label},n.id))})}),s.jsx("div",{className:"p-6",children:a()})]})]})]})};export{Gt as AdminPage};
