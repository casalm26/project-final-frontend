import{f as F,r as d,j as e,e as I}from"./index-bfSkSDqu.js";import{u as R,D as L,a as O,G as P}from"./useSidebarState-B8rAbqgf.js";import{e as U}from"./dataService-BoygT-IQ.js";import"./vendor-BtP0CW_r.js";import"./DarkModeToggle-BAF7j-d7.js";import"./IconButton-BdhL6o-U.js";const V=()=>{const{sidebarOpen:N,toggleSidebar:u}=R(),{showToast:f}=F(),[a,k]=d.useState({}),[l,j]=d.useState("csv"),[n,b]=d.useState("filtered"),[h,v]=d.useState({basicInfo:!0,measurements:!0,location:!0,health:!0,images:!1,metadata:!1}),[p,y]=d.useState(!1),w=d.useCallback(t=>{k(t)},[]),E=t=>{v(s=>({...s,[t]:!s[t]}))},S=async()=>{var t,s,i;y(!0);try{const r={format:l,scope:n,...h};n==="filtered"&&((t=a.dateRange)!=null&&t.startDate&&((s=a.dateRange)!=null&&s.endDate)&&(r.startDate=a.dateRange.startDate.toISOString(),r.endDate=a.dateRange.endDate.toISOString()),((i=a.selectedForests)==null?void 0:i.length)>0&&(r.forestIds=a.selectedForests.join(",")));const m=await U.exportTrees(r),o=new Blob([m],{type:l==="csv"?"text/csv":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),g=window.URL.createObjectURL(o),c=document.createElement("a");c.href=g,c.download=`trees_export_${new Date().toISOString().split("T")[0]}.${l}`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(g),f("Export completed successfully!","success")}catch(r){console.error("Export failed:",r),f("Export failed. Please try again.","error")}finally{y(!1)}},C=()=>{var i,r,m;const t=Object.values(h).filter(o=>o).length;let s="all records";if(n==="filtered"&&(((i=a.selectedForests)==null?void 0:i.length)>0&&(s=`records from ${a.selectedForests.length} forest(s)`),(r=a.dateRange)!=null&&r.startDate&&((m=a.dateRange)!=null&&m.endDate))){const o=a.dateRange.startDate.toLocaleDateString(),g=a.dateRange.endDate.toLocaleDateString();s+=` between ${o} - ${g}`}return{includeCount:t,recordEstimate:s}},{includeCount:x,recordEstimate:D}=C();return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(L,{onMenuClick:u}),e.jsxs("div",{className:"flex",children:[e.jsx(O,{isOpen:N,onClose:()=>u(!1)}),e.jsx("main",{className:"flex-1 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Data Export"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Export your tree data in various formats with customizable options"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Export Scope"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"all",checked:n==="all",onChange:t=>b(t.target.value),className:"w-4 h-4 text-green-600 focus:ring-green-500"}),e.jsxs("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"All Data"}),e.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400",children:"Export entire database without any filters"})]})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"filtered",checked:n==="filtered",onChange:t=>b(t.target.value),className:"w-4 h-4 text-green-600 focus:ring-green-500"}),e.jsxs("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Filtered Data"}),e.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400",children:"Export only data matching the filters below"})]})]})]})]}),n==="filtered"&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:e.jsx(P,{onFiltersChange:w})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Data Fields to Include"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries({basicInfo:"Basic Information (ID, Name, Species)",measurements:"Measurements (Height, Diameter)",location:"Location (Coordinates, Forest)",health:"Health Status",images:"Image URLs",metadata:"Metadata (Created/Updated dates)"}).map(([t,s])=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:h[t],onChange:()=>E(t),className:"w-4 h-4 text-green-600 rounded focus:ring-green-500"}),e.jsx("span",{className:"ml-3 text-gray-700 dark:text-gray-300",children:s})]},t))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",style:{borderColor:l==="csv"?"#10b981":"#e5e7eb"},children:[e.jsx("input",{type:"radio",value:"csv",checked:l==="csv",onChange:t=>j(t.target.value),className:"w-4 h-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"CSV"}),e.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400",children:"Comma-separated values, compatible with Excel"})]})]}),e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",style:{borderColor:l==="xlsx"?"#10b981":"#e5e7eb"},children:[e.jsx("input",{type:"radio",value:"xlsx",checked:l==="xlsx",onChange:t=>j(t.target.value),className:"w-4 h-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Excel (XLSX)"}),e.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400",children:"Native Excel format with formatting"})]})]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 sticky top-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Export Preview"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Format:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white uppercase",children:l})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Scope:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white capitalize",children:n})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Fields:"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[x," selected"]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Exporting:"}),e.jsx("span",{className:"block font-medium text-gray-900 dark:text-white mt-1",children:D})]})]}),e.jsx("button",{onClick:S,disabled:p||x===0,className:`w-full py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center ${p||x===0?"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,children:p?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"small",className:"mr-2"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export Data"]})}),x===0&&e.jsx("p",{className:"mt-3 text-sm text-red-600 dark:text-red-400",children:"Please select at least one field to export"})]})})]})]})})]})]})};export{V as ExportPage};
