import{A as ne,j as s,p as oe,r as S,e as Y,u as $,d as k,h as ie,N as le}from"./index-bfSkSDqu.js";import{E as de,T as ce,a as ue,b as Q,c as H,d as N,S as ge,e as me,f as he,g as pe,M as fe}from"./Modal-CwRIuUem.js";import{F as xe,S as ee,a as ye,A as be,P as ve}from"./FormElements-DdY3qy6J.js";import{u as je}from"./with-selector-C5k5o92S.js";import{t as C}from"./treeService-DUeRkfZa.js";import{F as _}from"./FormField-BxrZEgdH.js";import{c as Se,l as we,a as Te,e as ke,M as Ae,T as Ee,b as _e,L as te}from"./leaflet-CdEKyoTF.js";import"./vendor-BtP0CW_r.js";const F=new ne,I={getAll:(r={})=>F.get("/forests",r),getById:r=>F.get(`/forests/${r}`),getAnalytics:r=>F.get(`/forests/${r}/analytics`),create:r=>F.post("/forests",r),update:(r,o)=>F.put(`/forests/${r}`,o),delete:r=>F.delete(`/forests/${r}`)},Ce=Se(function({position:o,...e},t){const a=new we.Marker(o,e);return Te(a,ke(t,{overlayContainer:a}))},function(o,e,t){e.position!==t.position&&o.setLatLng(e.position),e.icon!=null&&e.icon!==t.icon&&o.setIcon(e.icon),e.zIndexOffset!=null&&e.zIndexOffset!==t.zIndexOffset&&o.setZIndexOffset(e.zIndexOffset),e.opacity!=null&&e.opacity!==t.opacity&&o.setOpacity(e.opacity),o.dragging!=null&&e.draggable!==t.draggable&&(e.draggable===!0?o.dragging.enable():o.dragging.disable())}),M={CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",LOGIN:"LOGIN",LOGOUT:"LOGOUT"},Ie=[{value:"",label:"All Actions"},{value:M.CREATE,label:"Create"},{value:M.UPDATE,label:"Update"},{value:M.DELETE,label:"Delete"},{value:M.LOGIN,label:"Login"},{value:M.LOGOUT,label:"Logout"}],re=10,Ne=({searchTerm:r,setSearchTerm:o,actionFilter:e,setActionFilter:t})=>s.jsxs(xe,{children:[s.jsx(ee,{type:"text",placeholder:"Search by user, action, or details...",value:r,onChange:a=>o(a.target.value)}),s.jsx(ye,{value:e,onChange:a=>t(a.target.value),children:Ie.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))})]}),Fe={ASC:"asc"},z={NONE:"⇅",ASC:"↑",DESC:"↓"},Le=(r,o,e)=>o!==r?z.NONE:e===Fe.ASC?z.ASC:z.DESC,P=({field:r,sortField:o,sortDirection:e,onSort:t,children:a})=>s.jsxs(H,{onClick:()=>t(r),children:[a," ",s.jsx(ge,{children:Le(r,o,e)})]}),De=({sortField:r,sortDirection:o,onSort:e})=>s.jsx(ue,{children:s.jsxs(Q,{children:[s.jsx(P,{field:"timestamp",sortField:r,sortDirection:o,onSort:e,children:"Timestamp"}),s.jsx(P,{field:"user",sortField:r,sortDirection:o,onSort:e,children:"User"}),s.jsx(P,{field:"action",sortField:r,sortDirection:o,onSort:e,children:"Action"}),s.jsx(P,{field:"resource",sortField:r,sortDirection:o,onSort:e,children:"Resource"}),s.jsx(H,{children:"Details"}),s.jsx(H,{children:"IP Address"})]})}),Me=({log:r})=>s.jsxs(Q,{children:[s.jsx(N,{children:oe(r.timestamp)}),s.jsx(N,{children:r.user}),s.jsx(N,{children:s.jsx(be,{action:r.action,children:r.action})}),s.jsx(N,{children:r.resource}),s.jsx(N,{children:r.details}),s.jsx(N,{children:r.ipAddress})]},r.id),Oe=({logs:r,sortField:o,sortDirection:e,onSort:t})=>r.length===0?s.jsx(de,{children:s.jsx("p",{children:"No audit logs found matching your criteria."})}):s.jsxs(ce,{children:[s.jsx(De,{sortField:o,sortDirection:e,onSort:t}),s.jsx("tbody",{children:r.map(a=>s.jsx(Me,{log:a},a.id))})]}),Pe=[{id:1,timestamp:"2024-01-15T10:30:00Z",user:"admin@nanwa.com",action:"CREATE",resource:"Tree",resourceId:"tree_001",details:"Created new tree record for Forest A",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"},{id:2,timestamp:"2024-01-15T10:25:00Z",user:"user@nanwa.com",action:"UPDATE",resource:"Tree",resourceId:"tree_002",details:"Updated height measurement from 2.3m to 2.4m",ipAddress:"192.168.1.101",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},{id:3,timestamp:"2024-01-15T10:20:00Z",user:"admin@nanwa.com",action:"DELETE",resource:"Forest",resourceId:"forest_003",details:"Deleted forest record due to data cleanup",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"},{id:4,timestamp:"2024-01-15T10:15:00Z",user:"user@nanwa.com",action:"LOGIN",resource:"Authentication",resourceId:"auth_session_001",details:"User logged in successfully",ipAddress:"192.168.1.101",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},{id:5,timestamp:"2024-01-15T10:10:00Z",user:"admin@nanwa.com",action:"UPDATE",resource:"User",resourceId:"user_001",details:"Updated user permissions to admin level",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"},{id:6,timestamp:"2024-01-15T10:05:00Z",user:"system",action:"CREATE",resource:"Measurement",resourceId:"measurement_001",details:"Automated measurement recorded for tree batch",ipAddress:"127.0.0.1",userAgent:"System/1.0"},{id:7,timestamp:"2024-01-15T10:00:00Z",user:"user@nanwa.com",action:"LOGOUT",resource:"Authentication",resourceId:"auth_session_002",details:"User logged out",ipAddress:"192.168.1.101",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}],Re=()=>{const[r,o]=S.useState([]),[e,t]=S.useState(!1),a=async()=>{t(!0);try{await new Promise(n=>setTimeout(n,500)),o(Pe)}catch(n){console.error("Failed to fetch audit logs:",n)}finally{t(!1)}};return S.useEffect(()=>{a()},[]),{auditLogs:r,loading:e,refetchAuditLogs:a}},Ue=r=>{const[o,e]=S.useState(""),[t,a]=S.useState(""),[n,l]=S.useState("timestamp"),[i,x]=S.useState("desc"),c=S.useMemo(()=>r.filter(v=>{const b=o===""||v.user.toLowerCase().includes(o.toLowerCase())||v.details.toLowerCase().includes(o.toLowerCase())||v.resource.toLowerCase().includes(o.toLowerCase()),d=t===""||v.action===t;return b&&d}).sort((v,b)=>{const d=v[n],j=b[n];return i==="asc"?d>j?1:-1:d<j?1:-1}),[r,o,t,n,i]);return{searchTerm:o,setSearchTerm:e,actionFilter:t,setActionFilter:a,sortField:n,sortDirection:i,filteredAndSortedLogs:c,handleSort:v=>{n===v?x(i==="asc"?"desc":"asc"):(l(v),x("desc"))}}},ze=(r,o=re)=>{const[e,t]=S.useState(1),a=Math.ceil(r.length/o),n=(e-1)*o,l=r.slice(n,n+o);return S.useEffect(()=>{t(1)},[r.length]),{currentPage:e,setCurrentPage:t,totalPages:a,startIndex:n,paginatedData:l,pageSize:o}},Be=()=>{const{auditLogs:r,loading:o}=Re(),{searchTerm:e,setSearchTerm:t,actionFilter:a,setActionFilter:n,sortField:l,sortDirection:i,filteredAndSortedLogs:x,handleSort:c}=Ue(r),{currentPage:h,setCurrentPage:v,totalPages:b,startIndex:d,paginatedData:j,pageSize:u}=ze(x,re);return s.jsxs(me,{children:[s.jsxs(he,{children:[s.jsx(pe,{children:"Audit Log"}),s.jsx(Ne,{searchTerm:e,setSearchTerm:t,actionFilter:a,setActionFilter:n})]}),o?s.jsx(Y,{text:"Loading audit logs..."}):s.jsx(Oe,{logs:j,sortField:l,sortDirection:i,onSort:c}),s.jsx(ve,{currentPage:h,totalPages:b,startIndex:d,pageSize:u,totalItems:x.length,onPageChange:v})]})},He=k.header`
  background: white;
  border-bottom: 1px solid #e5e7eb;
  padding: 1rem 0;
`,We=k.div`
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
`,$e=k.a`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: #10b981;
  color: white;
  text-decoration: none;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.2s;
  
  &:hover {
    background: #059669;
  }
`,qe=k.span`
  padding: 0.5rem 1rem;
  background: #fee2e2;
  color: #991b1b;
  border-radius: 9999px;
  font-size: 0.875rem;
  font-weight: 500;
`,Je=k.div`
  display: flex;
  align-items: center;
  gap: 1rem;
`,Ge=k.span`
  font-size: 0.875rem;
  color: #374151;
`,Ve=k.button`
  color: #374151;
  background: none;
  border: none;
  padding: 0.5rem;
  border-radius: 0.375rem;
  cursor: pointer;
  transition: color 0.2s;
  
  &:hover {
    color: #10b981;
  }
`,Ze=()=>s.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),Ke=()=>s.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),Xe=()=>{const{user:r,logout:o}=$(),e=async()=>{await o()};return s.jsx(He,{children:s.jsxs(We,{children:[s.jsxs($e,{href:"/dashboard",children:[s.jsx(Ze,{}),"Back to Dashboard"]}),s.jsxs(Je,{children:[s.jsx(qe,{children:"Admin Panel"}),s.jsxs(Ge,{children:["Welcome, ",s.jsx("strong",{children:r==null?void 0:r.name})]}),s.jsx(Ve,{onClick:e,"aria-label":"Logout",children:s.jsx(Ke,{})})]})]})})},Ye=k.div`
  background: white;
  padding: 1.5rem;
  border-radius: 0.75rem;
  border: 1px solid #e5e7eb;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
`,Qe=k.div`
  font-size: 2rem;
  font-weight: 700;
  color: #111827;
  margin-bottom: 0.5rem;
`,et=k.div`
  font-size: 0.875rem;
  color: #6b7280;
  font-weight: 500;
`,tt=k.div`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 3rem;
  height: 3rem;
  border-radius: 0.75rem;
  margin-bottom: 1rem;
  
  ${r=>{switch(r.type){case"users":return"background: #dbeafe; color: #1e40af;";case"actions":return"background: #d1fae5; color: #065f46;";case"errors":return"background: #fee2e2; color: #991b1b;";case"activity":return"background: #fef3c7; color: #92400e;";default:return"background: #f3f4f6; color: #374151;"}}}
`,rt=({icon:r,value:o,label:e,type:t})=>s.jsxs(Ye,{children:[s.jsx(tt,{type:t,children:r}),s.jsx(Qe,{children:o}),s.jsx(et,{children:e})]}),st=k.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
`,at=()=>s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),nt=()=>s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),ot=()=>s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),it=()=>s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),lt=()=>{const r=[{icon:s.jsx(at,{}),value:"42",label:"Active Users",type:"users"},{icon:s.jsx(nt,{}),value:"1,247",label:"Total Actions Today",type:"actions"},{icon:s.jsx(ot,{}),value:"3",label:"Failed Actions",type:"errors"},{icon:s.jsx(it,{}),value:"98.5%",label:"System Uptime",type:"activity"}];return s.jsx(st,{children:r.map((o,e)=>s.jsx(rt,{icon:o.icon,value:o.value,label:o.label,type:o.type},e))})},dt={},Z=r=>{let o;const e=new Set,t=(h,v)=>{const b=typeof h=="function"?h(o):h;if(!Object.is(b,o)){const d=o;o=v??(typeof b!="object"||b===null)?b:Object.assign({},o,b),e.forEach(j=>j(o,d))}},a=()=>o,x={setState:t,getState:a,getInitialState:()=>c,subscribe:h=>(e.add(h),()=>e.delete(h)),destroy:()=>{(dt?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),e.clear()}},c=o=r(t,a,x);return x},ct=r=>r?Z(r):Z,se={},{useDebugValue:ut}=ie,{useSyncExternalStoreWithSelector:gt}=je;let K=!1;const mt=r=>r;function ht(r,o=mt,e){(se?"production":void 0)!=="production"&&e&&!K&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),K=!0);const t=gt(r.subscribe,r.getState,r.getServerState||r.getInitialState,o,e);return ut(t),t}const X=r=>{(se?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const o=typeof r=="function"?ct(r):r,e=(t,a)=>ht(o,t,a);return Object.assign(e,o),e},L=r=>r?X(r):X,U={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_TIMEOUT:"10000",VITE_API_URL:"https://project-final-frontend-4bia.onrender.com/api",VITE_ENABLE_ANALYTICS:"false",VITE_ENABLE_DARK_MODE:"true",VITE_ENV:"development",VITE_MAP_API_KEY:"your_map_api_key_here",VITE_MAP_TILE_URL:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",VITE_SENTRY_DSN:"your_sentry_dsn_here"},W=new Map,R=r=>{const o=W.get(r);return o?Object.fromEntries(Object.entries(o.stores).map(([e,t])=>[e,t.getState()])):{}},pt=(r,o,e)=>{if(r===void 0)return{type:"untracked",connection:o.connect(e)};const t=W.get(e.name);if(t)return{type:"tracked",store:r,...t};const a={connection:o.connect(e),stores:{}};return W.set(e.name,a),{type:"tracked",store:r,...a}},ft=(r,o={})=>(e,t,a)=>{const{enabled:n,anonymousActionType:l,store:i,...x}=o;let c;try{c=(n??(U?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!c)return(U?"production":void 0)!=="production"&&n&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),r(e,t,a);const{connection:h,...v}=pt(i,c,x);let b=!0;a.setState=(u,g,f)=>{const p=e(u,g);if(!b)return p;const y=f===void 0?{type:l||"anonymous"}:typeof f=="string"?{type:f}:f;return i===void 0?(h==null||h.send(y,t()),p):(h==null||h.send({...y,type:`${i}/${y.type}`},{...R(x.name),[i]:a.getState()}),p)};const d=(...u)=>{const g=b;b=!1,e(...u),b=g},j=r(a.setState,t,a);if(v.type==="untracked"?h==null||h.init(j):(v.stores[v.store]=a,h==null||h.init(Object.fromEntries(Object.entries(v.stores).map(([u,g])=>[u,u===v.store?j:g.getState()])))),a.dispatchFromDevtools&&typeof a.dispatch=="function"){let u=!1;const g=a.dispatch;a.dispatch=(...f)=>{(U?"production":void 0)!=="production"&&f[0].type==="__setState"&&!u&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),u=!0),g(...f)}}return h.subscribe(u=>{var g;switch(u.type){case"ACTION":if(typeof u.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return B(u.payload,f=>{if(f.type==="__setState"){if(i===void 0){d(f.state);return}Object.keys(f.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const p=f.state[i];if(p==null)return;JSON.stringify(a.getState())!==JSON.stringify(p)&&d(p);return}a.dispatchFromDevtools&&typeof a.dispatch=="function"&&a.dispatch(f)});case"DISPATCH":switch(u.payload.type){case"RESET":return d(j),i===void 0?h==null?void 0:h.init(a.getState()):h==null?void 0:h.init(R(x.name));case"COMMIT":if(i===void 0){h==null||h.init(a.getState());return}return h==null?void 0:h.init(R(x.name));case"ROLLBACK":return B(u.state,f=>{if(i===void 0){d(f),h==null||h.init(a.getState());return}d(f[i]),h==null||h.init(R(x.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return B(u.state,f=>{if(i===void 0){d(f);return}JSON.stringify(a.getState())!==JSON.stringify(f[i])&&d(f[i])});case"IMPORT_STATE":{const{nextLiftedState:f}=u.payload,p=(g=f.computedStates.slice(-1)[0])==null?void 0:g.state;if(!p)return;d(i===void 0?p:p[i]),h==null||h.send(null,f);return}case"PAUSE_RECORDING":return b=!b}return}}),j},D=ft,B=(r,o)=>{let e;try{e=JSON.parse(r)}catch(t){console.error("[zustand devtools middleware] Could not parse the received json",t)}e!==void 0&&o(e)};function xt(r,o){let e;try{e=r()}catch{return}return{getItem:a=>{var n;const l=x=>x===null?null:JSON.parse(x,void 0),i=(n=e.getItem(a))!=null?n:null;return i instanceof Promise?i.then(l):l(i)},setItem:(a,n)=>e.setItem(a,JSON.stringify(n,void 0)),removeItem:a=>e.removeItem(a)}}const O=r=>o=>{try{const e=r(o);return e instanceof Promise?e:{then(t){return O(t)(e)},catch(t){return this}}}catch(e){return{then(t){return this},catch(t){return O(t)(e)}}}},yt=(r,o)=>(e,t,a)=>{let n={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:g=>g,version:0,merge:(g,f)=>({...f,...g}),...o},l=!1;const i=new Set,x=new Set;let c;try{c=n.getStorage()}catch{}if(!c)return r((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),e(...g)},t,a);const h=O(n.serialize),v=()=>{const g=n.partialize({...t()});let f;const p=h({state:g,version:n.version}).then(y=>c.setItem(n.name,y)).catch(y=>{f=y});if(f)throw f;return p},b=a.setState;a.setState=(g,f)=>{b(g,f),v()};const d=r((...g)=>{e(...g),v()},t,a);let j;const u=()=>{var g;if(!c)return;l=!1,i.forEach(p=>p(t()));const f=((g=n.onRehydrateStorage)==null?void 0:g.call(n,t()))||void 0;return O(c.getItem.bind(c))(n.name).then(p=>{if(p)return n.deserialize(p)}).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==n.version){if(n.migrate)return n.migrate(p.state,p.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return p.state}).then(p=>{var y;return j=n.merge(p,(y=t())!=null?y:d),e(j,!0),v()}).then(()=>{f==null||f(j,void 0),l=!0,x.forEach(p=>p(j))}).catch(p=>{f==null||f(void 0,p)})};return a.persist={setOptions:g=>{n={...n,...g},g.getStorage&&(c=g.getStorage())},clearStorage:()=>{c==null||c.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>u(),hasHydrated:()=>l,onHydrate:g=>(i.add(g),()=>{i.delete(g)}),onFinishHydration:g=>(x.add(g),()=>{x.delete(g)})},u(),j||d},bt=(r,o)=>(e,t,a)=>{let n={storage:xt(()=>localStorage),partialize:u=>u,version:0,merge:(u,g)=>({...g,...u}),...o},l=!1;const i=new Set,x=new Set;let c=n.storage;if(!c)return r((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),e(...u)},t,a);const h=()=>{const u=n.partialize({...t()});return c.setItem(n.name,{state:u,version:n.version})},v=a.setState;a.setState=(u,g)=>{v(u,g),h()};const b=r((...u)=>{e(...u),h()},t,a);a.getInitialState=()=>b;let d;const j=()=>{var u,g;if(!c)return;l=!1,i.forEach(p=>{var y;return p((y=t())!=null?y:b)});const f=((g=n.onRehydrateStorage)==null?void 0:g.call(n,(u=t())!=null?u:b))||void 0;return O(c.getItem.bind(c))(n.name).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==n.version){if(n.migrate)return[!0,n.migrate(p.state,p.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,p.state];return[!1,void 0]}).then(p=>{var y;const[A,m]=p;if(d=n.merge(m,(y=t())!=null?y:b),e(d,!0),A)return h()}).then(()=>{f==null||f(d,void 0),d=t(),l=!0,x.forEach(p=>p(d))}).catch(p=>{f==null||f(void 0,p)})};return a.persist={setOptions:u=>{n={...n,...u},u.storage&&(c=u.storage)},clearStorage:()=>{c==null||c.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>j(),hasHydrated:()=>l,onHydrate:u=>(i.add(u),()=>{i.delete(u)}),onFinishHydration:u=>(x.add(u),()=>{x.delete(u)})},n.skipHydration||j(),d||b},vt=(r,o)=>"getStorage"in o||"serialize"in o||"deserialize"in o?((U?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),yt(r,o)):bt(r,o),ae=vt;L(D(ae((r,o)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,login:(e,t)=>{localStorage.setItem("authToken",t),r({user:e,token:t,isAuthenticated:!0,isLoading:!1})},logout:()=>{localStorage.removeItem("authToken"),r({user:null,token:null,isAuthenticated:!1,isLoading:!1})},setLoading:e=>r({isLoading:e}),updateUser:e=>r({user:e})}),{name:"auth-storage",partialize:r=>({user:r.user,token:r.token,isAuthenticated:r.isAuthenticated})}),{name:"auth-store"}));const jt=L(D(ae((r,o)=>({filters:{dateRange:{start:null,end:null},forests:[],regions:[],species:[],status:"all",soilCondition:"",sunlightExposure:"",search:""},setFilters:e=>r(t=>({filters:{...t.filters,...e}})),clearFilters:()=>r({filters:{dateRange:{start:null,end:null},forests:[],regions:[],species:[],status:"all",soilCondition:"",sunlightExposure:"",search:""}}),setDateRange:e=>r(t=>({filters:{...t.filters,dateRange:e}})),setForestFilter:e=>r(t=>({filters:{...t.filters,forests:e}})),setRegionFilter:e=>r(t=>({filters:{...t.filters,regions:e}})),setSpeciesFilter:e=>r(t=>({filters:{...t.filters,species:e}})),setStatusFilter:e=>r(t=>({filters:{...t.filters,status:e}})),setSoilConditionFilter:e=>r(t=>({filters:{...t.filters,soilCondition:e}})),setSunlightExposureFilter:e=>r(t=>({filters:{...t.filters,sunlightExposure:e}})),setSearchFilter:e=>r(t=>({filters:{...t.filters,search:e}})),getActiveFiltersCount:()=>{const{filters:e}=o();let t=0;return(e.dateRange.start||e.dateRange.end)&&t++,e.forests.length>0&&t++,e.regions.length>0&&t++,e.species.length>0&&t++,e.status!=="all"&&t++,e.soilCondition&&t++,e.sunlightExposure&&t++,e.search.trim()&&t++,t},hasActiveFilters:()=>o().getActiveFiltersCount()>0,getApiParams:()=>{const{filters:e}=o(),t={};return e.dateRange.start&&(t.startDate=e.dateRange.start),e.dateRange.end&&(t.endDate=e.dateRange.end),e.forests.length>0&&(t.forestIds=e.forests.join(",")),e.regions.length>0&&(t.regions=e.regions.join(",")),e.species.length>0&&(t.species=e.species.join(",")),e.status!=="all"&&(t.status=e.status),e.soilCondition&&(t.soilCondition=e.soilCondition),e.sunlightExposure&&(t.sunlightExposure=e.sunlightExposure),e.search.trim()&&(t.search=e.search.trim()),t}}),{name:"filters-storage",partialize:r=>({filters:r.filters})}),{name:"filters-store"}));L(D((r,o)=>({sidebarOpen:!1,darkMode:!1,setSidebarOpen:e=>r({sidebarOpen:e}),toggleSidebar:()=>r(e=>({sidebarOpen:!e.sidebarOpen})),setDarkMode:e=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),r({darkMode:e})},toggleDarkMode:()=>{const e=!o().darkMode;e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),r({darkMode:e})}}),{name:"ui-store"}));L(D((r,o)=>({forests:[],trees:[],loading:!1,error:null,lastFetch:{forests:null,trees:null},setForests:e=>r({forests:e,lastFetch:{...o().lastFetch,forests:Date.now()}}),setTrees:e=>r({trees:e,lastFetch:{...o().lastFetch,trees:Date.now()}}),setLoading:e=>r({loading:e}),setError:e=>r({error:e}),clearError:()=>r({error:null}),fetchForests:async(e=!1)=>{var l;const t=o(),n=Date.now()-(t.lastFetch.forests||0)<5*60*1e3;if(!e&&t.forests.length>0&&n)return t.forests;r({loading:!0,error:null});try{const i=await I.getAll(),x=((l=i.data)==null?void 0:l.forests)||i.data||[];return r({forests:x,loading:!1,lastFetch:{...t.lastFetch,forests:Date.now()}}),x}catch(i){throw r({error:i.message,loading:!1}),i}},fetchTrees:async(e={},t=!1)=>{var i;const a=o(),l=Date.now()-(a.lastFetch.trees||0)<5*60*1e3;if(!t&&a.trees.length>0&&l&&Object.keys(e).length===0)return a.trees;r({loading:!0,error:null});try{const x=await C.getAll(e),c=((i=x.data)==null?void 0:i.trees)||x.data||[];return r({trees:c,loading:!1,lastFetch:{...a.lastFetch,trees:Date.now()}}),c}catch(x){throw r({error:x.message,loading:!1}),x}},addForest:e=>r(t=>({forests:[...t.forests,e]})),updateForest:(e,t)=>r(a=>({forests:a.forests.map(n=>(n._id||n.id)===e?{...n,...t}:n)})),removeForest:e=>r(t=>({forests:t.forests.filter(a=>(a._id||a.id)!==e)})),addTree:e=>r(t=>({trees:[...t.trees,e]})),updateTree:(e,t)=>r(a=>({trees:a.trees.map(n=>(n._id||n.id)===e?{...n,...t}:n)})),removeTree:e=>r(t=>({trees:t.trees.filter(a=>(a._id||a.id)!==e)})),getForestById:e=>o().forests.find(t=>(t._id||t.id)===e),getTreeById:e=>o().trees.find(t=>(t._id||t.id)===e),getTreesByForest:e=>o().trees.filter(t=>{var n;return(((n=t.forestId)==null?void 0:n._id)||t.forestId)===e}),clearCache:()=>r({lastFetch:{forests:null,trees:null}}),reset:()=>r({forests:[],trees:[],loading:!1,error:null,lastFetch:{forests:null,trees:null}})}),{name:"data-store"}));const St=L(D((r,o)=>({trees:[],selectedTree:null,loading:!1,error:null,pagination:{page:1,limit:20,total:0,totalPages:0},measurements:{},setTrees:e=>r({trees:e}),setSelectedTree:e=>r({selectedTree:e}),setLoading:e=>r({loading:e}),setError:e=>r({error:e}),clearError:()=>r({error:null}),setPagination:e=>r({pagination:e}),createTree:async e=>{r({loading:!0,error:null});try{const a=(await C.create(e)).data;return r(n=>({trees:[a,...n.trees],loading:!1})),a}catch(t){throw r({error:t.message,loading:!1}),t}},updateTree:async(e,t)=>{r({loading:!0,error:null});try{const n=(await C.update(e,t)).data;return r(l=>({trees:l.trees.map(i=>(i._id||i.id)===e?n:i),selectedTree:l.selectedTree&&(l.selectedTree._id||l.selectedTree.id)===e?n:l.selectedTree,loading:!1})),n}catch(a){throw r({error:a.message,loading:!1}),a}},deleteTree:async e=>{r({loading:!0,error:null});try{await C.delete(e),r(t=>({trees:t.trees.filter(a=>(a._id||a.id)!==e),selectedTree:t.selectedTree&&(t.selectedTree._id||t.selectedTree.id)===e?null:t.selectedTree,loading:!1}))}catch(t){throw r({error:t.message,loading:!1}),t}},markTreeDead:async(e,t)=>{r({loading:!0,error:null});try{const n=(await C.markDead(e,{reason:t})).data;return r(l=>({trees:l.trees.map(i=>(i._id||i.id)===e?n:i),selectedTree:l.selectedTree&&(l.selectedTree._id||l.selectedTree.id)===e?n:l.selectedTree,loading:!1})),n}catch(a){throw r({error:a.message,loading:!1}),a}},addMeasurement:async(e,t)=>{r({loading:!0,error:null});try{const n=(await C.addMeasurement(e,t)).data;return r(l=>({trees:l.trees.map(i=>(i._id||i.id)===e?n:i),selectedTree:l.selectedTree&&(l.selectedTree._id||l.selectedTree.id)===e?n:l.selectedTree,loading:!1})),n}catch(a){throw r({error:a.message,loading:!1}),a}},fetchTreeMeasurements:async(e,t=!1)=>{const a=o();if(!t&&a.measurements[e])return a.measurements[e];r({loading:!0,error:null});try{const l=(await C.getMeasurements(e)).data;return r(i=>({measurements:{...i.measurements,[e]:l},loading:!1})),l}catch(n){throw r({error:n.message,loading:!1}),n}},fetchTrees:async(e={})=>{r({loading:!0,error:null});try{const t=await C.getAll({page:e.page||o().pagination.page,limit:e.limit||o().pagination.limit,...e}),{trees:a,pagination:n}=t.data;return r({trees:a||[],pagination:n||o().pagination,loading:!1}),{trees:a,pagination:n}}catch(t){throw r({error:t.message,loading:!1}),t}},getTreeById:e=>o().trees.find(t=>(t._id||t.id)===e),getTreesByForest:e=>o().trees.filter(t=>{var n;return(((n=t.forestId)==null?void 0:n._id)||t.forestId)===e}),getTreesByStatus:e=>{if(e==="all")return o().trees;const t=e==="alive";return o().trees.filter(a=>a.status===(t?"alive":"dead"))},getTreesBySpecies:e=>!e||e.length===0?o().trees:o().trees.filter(t=>e.includes(t.species)),searchTrees:e=>{if(!e.trim())return o().trees;const t=e.toLowerCase();return o().trees.filter(a=>{var n;return a.treeId.toLowerCase().includes(t)||a.species.toLowerCase().includes(t)||((n=a.metadata)==null?void 0:n.notes)&&a.metadata.notes.toLowerCase().includes(t)})},getTreeStats:()=>{const e=o().trees,t=e.filter(i=>i.status==="alive").length,a=e.filter(i=>i.status==="dead").length,n=e.length,l=e.reduce((i,x)=>(i[x.species]=(i[x.species]||0)+1,i),{});return{total:n,alive:t,dead:a,survivalRate:n>0?t/n*100:0,speciesCount:l}},reset:()=>r({trees:[],selectedTree:null,loading:!1,error:null,pagination:{page:1,limit:20,total:0,totalPages:0},measurements:{}})}),{name:"tree-store"}));L(D((r,o)=>({forests:[],selectedForest:null,loading:!1,error:null,analytics:{},setForests:e=>r({forests:e}),setSelectedForest:e=>r({selectedForest:e}),setLoading:e=>r({loading:e}),setError:e=>r({error:e}),clearError:()=>r({error:null}),createForest:async e=>{r({loading:!0,error:null});try{const a=(await I.create(e)).data;return r(n=>({forests:[a,...n.forests],loading:!1})),a}catch(t){throw r({error:t.message,loading:!1}),t}},updateForest:async(e,t)=>{r({loading:!0,error:null});try{const n=(await I.update(e,t)).data;return r(l=>({forests:l.forests.map(i=>(i._id||i.id)===e?n:i),selectedForest:l.selectedForest&&(l.selectedForest._id||l.selectedForest.id)===e?n:l.selectedForest,loading:!1})),n}catch(a){throw r({error:a.message,loading:!1}),a}},deleteForest:async e=>{r({loading:!0,error:null});try{await I.delete(e),r(t=>({forests:t.forests.filter(a=>(a._id||a.id)!==e),selectedForest:t.selectedForest&&(t.selectedForest._id||t.selectedForest.id)===e?null:t.selectedForest,loading:!1}))}catch(t){throw r({error:t.message,loading:!1}),t}},fetchForests:async(e={})=>{var t;r({loading:!0,error:null});try{const a=await I.getAll(e),n=((t=a.data)==null?void 0:t.forests)||a.data||[];return r({forests:n,loading:!1}),n}catch(a){throw r({error:a.message,loading:!1}),a}},fetchForestById:async e=>{r({loading:!0,error:null});try{const a=(await I.getById(e)).data;return r(n=>({selectedForest:a,forests:n.forests.map(l=>(l._id||l.id)===e?a:l),loading:!1})),a}catch(t){throw r({error:t.message,loading:!1}),t}},fetchForestAnalytics:async(e,t=!1)=>{const a=o();if(!t&&a.analytics[e])return a.analytics[e];r({loading:!0,error:null});try{const l=(await I.getAnalytics(e)).data;return r(i=>({analytics:{...i.analytics,[e]:l},loading:!1})),l}catch(n){throw r({error:n.message,loading:!1}),n}},getForestById:e=>o().forests.find(t=>(t._id||t.id)===e),getForestsByRegion:e=>e?o().forests.filter(t=>t.region===e):o().forests,searchForests:e=>{if(!e.trim())return o().forests;const t=e.toLowerCase();return o().forests.filter(a=>a.name.toLowerCase().includes(t)||a.region.toLowerCase().includes(t)||a.description&&a.description.toLowerCase().includes(t))},getRegions:()=>{const e=o().forests;return[...new Set(e.map(t=>t.region).filter(Boolean))]},getForestStats:()=>{const e=o().forests,t=e.length,a=e.reduce((l,i)=>l+(i.area||0),0),n=e.reduce((l,i)=>(i.region&&(l[i.region]=(l[i.region]||0)+1),l),{});return{total:t,totalArea:a,regionCount:n,averageArea:t>0?a/t:0}},getForestOptions:()=>o().forests.map(e=>({value:e._id||e.id,label:e.name})),reset:()=>r({forests:[],selectedForest:null,loading:!1,error:null,analytics:{}})}),{name:"forest-store"}));delete te.Icon.Default.prototype._getIconUrl;te.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const wt=({position:r,setPosition:o})=>{const e=_e({click(t){const a=[t.latlng.lat,t.latlng.lng];o(a),e.flyTo(t.latlng,e.getZoom())}});return r===null?null:s.jsx(Ce,{position:r})},Tt=({latitude:r,longitude:o,onLocationChange:e,height:t="300px",className:a=""})=>{const[n,l]=S.useState(null);S.useEffect(()=>{r&&o&&!isNaN(parseFloat(r))&&!isNaN(parseFloat(o))&&l([parseFloat(r),parseFloat(o)])},[r,o]),S.useEffect(()=>{n&&e&&e({latitude:n[0].toString(),longitude:n[1].toString()})},[n,e]);const i=(h,v)=>{const b=parseFloat(h),d=parseFloat(v);!isNaN(b)&&!isNaN(d)&&b>=-90&&b<=90&&d>=-180&&d<=180&&l([b,d])},c=n||[59.3293,18.0686];return s.jsxs("div",{className:a,children:[s.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Latitude"}),s.jsx("input",{type:"number",step:"any",value:n?n[0]:r||"",onChange:h=>i(h.target.value,n?n[1]:o),className:"form-input w-full",placeholder:"e.g., 59.3293"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Longitude"}),s.jsx("input",{type:"number",step:"any",value:n?n[1]:o||"",onChange:h=>i(n?n[0]:r,h.target.value),className:"form-input w-full",placeholder:"e.g., 18.0686"})]})]}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Click on the map to set the tree location, or enter coordinates manually above."}),s.jsx("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",style:{height:t},children:s.jsxs(Ae,{center:c,zoom:n?15:10,style:{height:"100%",width:"100%"},children:[s.jsx(Ee,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),s.jsx(wt,{position:n,setPosition:l})]},c.join(","))}),n&&s.jsx("div",{className:"mt-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:s.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[s.jsx("strong",{children:"Selected Location:"})," ",n[0].toFixed(6),", ",n[1].toFixed(6)]})})]})},kt=({isOpen:r,onClose:o,tree:e=null,onSuccess:t})=>{const{user:a}=$(),[n,l]=S.useState([]),[i,x]=S.useState(!1),[c,h]=S.useState({}),[v,b]=S.useState(!1),[d,j]=S.useState({treeId:"",forestId:"",species:"",plantedDate:"",latitude:"",longitude:"",soilCondition:"",sunlightExposure:"",notes:""}),u=!!e;S.useEffect(()=>{r&&(async()=>{var w;try{const T=await I.getAll(),E=((w=T.data)==null?void 0:w.forests)||T.data||[];l(E)}catch(T){console.error("Failed to load forests:",T)}})()},[r]),S.useEffect(()=>{var m,w,T,E,q,J,G,V;j(e?{treeId:e.treeId||"",forestId:((m=e.forestId)==null?void 0:m._id)||e.forestId||"",species:e.species||"",plantedDate:e.plantedDate?new Date(e.plantedDate).toISOString().split("T")[0]:"",latitude:((T=(w=e.location)==null?void 0:w.coordinates)==null?void 0:T[1])||e.lat||"",longitude:((q=(E=e.location)==null?void 0:E.coordinates)==null?void 0:q[0])||e.lng||"",soilCondition:((J=e.metadata)==null?void 0:J.soilCondition)||"",sunlightExposure:((G=e.metadata)==null?void 0:G.sunlightExposure)||"",notes:((V=e.metadata)==null?void 0:V.notes)||""}:{treeId:"",forestId:"",species:"",plantedDate:"",latitude:"",longitude:"",soilCondition:"",sunlightExposure:"",notes:""}),h({})},[e]);const g=(m,w)=>{j(T=>({...T,[m]:w})),c[m]&&h(T=>({...T,[m]:null}))},f=({latitude:m,longitude:w})=>{j(T=>({...T,latitude:m,longitude:w})),h(T=>({...T,latitude:null,longitude:null}))},p=()=>{const m={};if(d.treeId.trim()||(m.treeId="Tree ID is required"),d.forestId||(m.forestId="Forest is required"),d.species.trim()||(m.species="Species is required"),d.plantedDate||(m.plantedDate="Planted date is required"),!d.latitude||isNaN(parseFloat(d.latitude)))m.latitude="Valid latitude is required";else{const w=parseFloat(d.latitude);(w<-90||w>90)&&(m.latitude="Latitude must be between -90 and 90")}if(!d.longitude||isNaN(parseFloat(d.longitude)))m.longitude="Valid longitude is required";else{const w=parseFloat(d.longitude);(w<-180||w>180)&&(m.longitude="Longitude must be between -180 and 180")}return h(m),Object.keys(m).length===0},y=async m=>{var w,T;if(m.preventDefault(),!!p()){x(!0);try{const E={treeId:d.treeId,forestId:d.forestId,species:d.species,plantedDate:d.plantedDate,location:{type:"Point",coordinates:[parseFloat(d.longitude),parseFloat(d.latitude)]},metadata:{soilCondition:d.soilCondition||void 0,sunlightExposure:d.sunlightExposure||void 0,notes:d.notes||void 0}};u?await C.update(e._id,E):await C.create(E),t==null||t(),o()}catch(E){console.error("Failed to save tree:",E),h({submit:((T=(w=E.response)==null?void 0:w.data)==null?void 0:T.message)||`Failed to ${u?"update":"create"} tree`})}finally{x(!1)}}},A=[{value:"",label:"Select sunlight exposure"},{value:"full_sun",label:"Full Sun"},{value:"partial_sun",label:"Partial Sun"},{value:"partial_shade",label:"Partial Shade"},{value:"full_shade",label:"Full Shade"}];return s.jsx(fe,{isOpen:r,onClose:o,title:`${u?"Edit":"Create"} Tree`,children:s.jsxs("form",{onSubmit:y,className:"space-y-6",children:[c.submit&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:c.submit}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(_,{label:"Tree ID",required:!0,error:c.treeId,children:s.jsx("input",{type:"text",value:d.treeId,onChange:m=>g("treeId",m.target.value),className:"form-input",placeholder:"e.g., TREE-001",disabled:i})}),s.jsx(_,{label:"Forest",required:!0,error:c.forestId,children:s.jsxs("select",{value:d.forestId,onChange:m=>g("forestId",m.target.value),className:"form-input",disabled:i,children:[s.jsx("option",{value:"",children:"Select a forest"}),n.map(m=>s.jsx("option",{value:m._id,children:m.name},m._id))]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(_,{label:"Species",required:!0,error:c.species,children:s.jsx("input",{type:"text",value:d.species,onChange:m=>g("species",m.target.value),className:"form-input",placeholder:"e.g., Pine, Oak, Birch",disabled:i})}),s.jsx(_,{label:"Planted Date",required:!0,error:c.plantedDate,children:s.jsx("input",{type:"date",value:d.plantedDate,onChange:m=>g("plantedDate",m.target.value),className:"form-input",disabled:i})})]}),s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h4",{className:"text-md font-medium text-gray-900 dark:text-white",children:"Tree Location"}),s.jsx("button",{type:"button",onClick:()=>b(!v),className:"text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 font-medium",disabled:i,children:v?"Use Manual Entry":"Use Map Picker"})]}),v?s.jsx(_,{label:"Select Location on Map",required:!0,error:c.latitude||c.longitude,children:s.jsx(Tt,{latitude:d.latitude,longitude:d.longitude,onLocationChange:f,height:"400px"})}):s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(_,{label:"Latitude",required:!0,error:c.latitude,helpText:"Between -90 and 90 degrees",children:s.jsx("input",{type:"number",step:"any",value:d.latitude,onChange:m=>g("latitude",m.target.value),className:"form-input",placeholder:"e.g., 59.3293",disabled:i})}),s.jsx(_,{label:"Longitude",required:!0,error:c.longitude,helpText:"Between -180 and 180 degrees",children:s.jsx("input",{type:"number",step:"any",value:d.longitude,onChange:m=>g("longitude",m.target.value),className:"form-input",placeholder:"e.g., 18.0686",disabled:i})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(_,{label:"Soil Condition",error:c.soilCondition,children:s.jsx("input",{type:"text",value:d.soilCondition,onChange:m=>g("soilCondition",m.target.value),className:"form-input",placeholder:"e.g., Sandy, Clay, Loamy",disabled:i})}),s.jsx(_,{label:"Sunlight Exposure",error:c.sunlightExposure,children:s.jsx("select",{value:d.sunlightExposure,onChange:m=>g("sunlightExposure",m.target.value),className:"form-input",disabled:i,children:A.map(m=>s.jsx("option",{value:m.value,children:m.label},m.value))})})]}),s.jsx(_,{label:"Notes",error:c.notes,children:s.jsx("textarea",{value:d.notes,onChange:m=>g("notes",m.target.value),className:"form-input resize-none",rows:"3",placeholder:"Additional notes about the tree...",disabled:i})}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",disabled:i,children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",disabled:i,children:i?"Saving...":u?"Update Tree":"Create Tree"})]})]})})},At=()=>{const{trees:r,loading:o,error:e,pagination:t,selectedTree:a,fetchTrees:n,deleteTree:l,setSelectedTree:i}=St(),{setSearchFilter:x}=jt(),[c,h]=S.useState(""),[v,b]=S.useState(!1),d=async(y="",A=1)=>{try{await n({page:A,limit:10,search:y})}catch(m){console.error("Failed to load trees:",m)}};S.useEffect(()=>{d(c,t.page)},[c,t.page]);const j=()=>{i(null),b(!0)},u=y=>{i(y),b(!0)},g=async y=>{if(window.confirm("Are you sure you want to delete this tree?"))try{await l(y)}catch(A){console.error("Failed to delete tree:",A),alert("Failed to delete tree. Please try again.")}},f=()=>{d(c,t.page)},p=y=>{const A=y.target.value;h(A),x(A),d(A,1)};return o&&r.length===0?s.jsx("div",{className:"flex justify-center items-center py-12",children:s.jsx(Y,{text:"Loading trees..."})}):s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[s.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Tree Management"}),s.jsx("button",{onClick:j,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Add Tree"})]}),s.jsx(ee,{type:"text",placeholder:"Search trees by ID or species...",value:c,onChange:p})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Tree ID"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Species"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Forest"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Location"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:r.map(y=>{var A,m;return s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-900",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:y.treeId}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:y.species}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:((A=y.forestId)==null?void 0:A.name)||"Unknown"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:(m=y.location)!=null&&m.coordinates?`${y.location.coordinates[1].toFixed(4)}, ${y.location.coordinates[0].toFixed(4)}`:"No location"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${y.isAlive?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"}`,children:y.isAlive?"Alive":"Dead"})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>u(y),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:"Edit"}),s.jsx("button",{onClick:()=>g(y._id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Delete"})]})})]},y._id)})})]})}),r.length===0&&!o&&s.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:c?"No trees found matching your search.":"No trees found."}),t.totalPages>1&&s.jsx("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Page ",t.page," of ",t.totalPages]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>d(c,Math.max(1,t.page-1)),disabled:t.page===1,className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded disabled:opacity-50",children:"Previous"}),s.jsx("button",{onClick:()=>d(c,Math.min(t.totalPages,t.page+1)),disabled:t.page===t.totalPages,className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded disabled:opacity-50",children:"Next"})]})]})}),s.jsx(kt,{isOpen:v,onClose:()=>b(!1),tree:a,onSuccess:f})]})},Et=k.div`
  min-height: 100vh;
  background-color: #f9fafb;
`,_t=k.main`
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
`,Ct=k.div`
  margin-bottom: 2rem;
`,It=k.h1`
  font-size: 2.5rem;
  font-weight: 700;
  color: #111827;
  margin: 0 0 1rem 0;
`,Nt=k.p`
  color: #6b7280;
  font-size: 1.125rem;
  margin: 0;
`,Ft=({children:r})=>s.jsx(Et,{children:r}),Lt=({title:r,description:o})=>s.jsxs(Ct,{children:[s.jsx(It,{children:r}),s.jsx(Nt,{children:o})]}),Dt=({children:r})=>s.jsx(_t,{children:r}),Wt=()=>{const{isAdmin:r}=$(),[o,e]=S.useState("audit");if(!r())return s.jsx(le,{to:"/dashboard",replace:!0});const t=[{id:"audit",label:"Audit Logs"},{id:"trees",label:"Tree Management"}],a=()=>{switch(o){case"trees":return s.jsx(At,{});case"audit":default:return s.jsx(Be,{})}};return s.jsxs(Ft,{children:[s.jsx(Xe,{}),s.jsxs(Dt,{children:[s.jsx(Lt,{title:"System Administration",description:"Monitor system activity, manage trees, and view comprehensive audit logging."}),s.jsx(lt,{}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow mb-6",children:[s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:s.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:t.map(n=>s.jsx("button",{onClick:()=>e(n.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${o===n.id?"border-green-500 text-green-600 dark:text-green-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300"}`,children:n.label},n.id))})}),s.jsx("div",{className:"p-6",children:a()})]})]})]})};export{Wt as AdminPage};
