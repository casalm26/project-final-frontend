import{A as $,j as e,n as Z,r as d,e as B,u as U,d as f,N as V}from"./index-Cp0G27Fl.js";import{E as K,T as X,a as J,b as H,c as _,d as T,S as Q,e as Y,f as ee,g as te,M as ae}from"./Modal-BNFLubTG.js";import{F as re,S as R,a as se,A as ne,P as oe}from"./FormElements-DFAqWcb0.js";import{t as M}from"./treeService-D86yjeOz.js";import{F as w}from"./FormField-BLwCJzgw.js";import{c as ie,l as le,a as de,e as ce,M as ue,T as ge,b as xe,L as q}from"./leaflet-DEYfr1U5.js";import"./vendor-BtP0CW_r.js";const C=new $,me={getAll:(t={})=>C.get("/forests",t),getById:t=>C.get(`/forests/${t}`),getAnalytics:t=>C.get(`/forests/${t}/analytics`),create:t=>C.post("/forests",t),update:(t,r)=>C.put(`/forests/${t}`,r),delete:t=>C.delete(`/forests/${t}`)},he=ie(function({position:r,...a},o){const l=new le.Marker(r,a);return de(l,ce(o,{overlayContainer:l}))},function(r,a,o){a.position!==o.position&&r.setLatLng(a.position),a.icon!=null&&a.icon!==o.icon&&r.setIcon(a.icon),a.zIndexOffset!=null&&a.zIndexOffset!==o.zIndexOffset&&r.setZIndexOffset(a.zIndexOffset),a.opacity!=null&&a.opacity!==o.opacity&&r.setOpacity(a.opacity),r.dragging!=null&&a.draggable!==o.draggable&&(a.draggable===!0?r.dragging.enable():r.dragging.disable())}),S={CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",LOGIN:"LOGIN",LOGOUT:"LOGOUT"},pe=[{value:"",label:"All Actions"},{value:S.CREATE,label:"Create"},{value:S.UPDATE,label:"Update"},{value:S.DELETE,label:"Delete"},{value:S.LOGIN,label:"Login"},{value:S.LOGOUT,label:"Logout"}],G=10,be=({searchTerm:t,setSearchTerm:r,actionFilter:a,setActionFilter:o})=>e.jsxs(re,{children:[e.jsx(R,{type:"text",placeholder:"Search by user, action, or details...",value:t,onChange:l=>r(l.target.value)}),e.jsx(se,{value:a,onChange:l=>o(l.target.value),children:pe.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),fe={ASC:"asc"},O={NONE:"⇅",ASC:"↑",DESC:"↓"},je=(t,r,a)=>r!==t?O.NONE:a===fe.ASC?O.ASC:O.DESC,E=({field:t,sortField:r,sortDirection:a,onSort:o,children:l})=>e.jsxs(_,{onClick:()=>o(t),children:[l," ",e.jsx(Q,{children:je(t,r,a)})]}),ye=({sortField:t,sortDirection:r,onSort:a})=>e.jsx(J,{children:e.jsxs(H,{children:[e.jsx(E,{field:"timestamp",sortField:t,sortDirection:r,onSort:a,children:"Timestamp"}),e.jsx(E,{field:"user",sortField:t,sortDirection:r,onSort:a,children:"User"}),e.jsx(E,{field:"action",sortField:t,sortDirection:r,onSort:a,children:"Action"}),e.jsx(E,{field:"resource",sortField:t,sortDirection:r,onSort:a,children:"Resource"}),e.jsx(_,{children:"Details"}),e.jsx(_,{children:"IP Address"})]})}),ve=({log:t})=>e.jsxs(H,{children:[e.jsx(T,{children:Z(t.timestamp)}),e.jsx(T,{children:t.user}),e.jsx(T,{children:e.jsx(ne,{action:t.action,children:t.action})}),e.jsx(T,{children:t.resource}),e.jsx(T,{children:t.details}),e.jsx(T,{children:t.ipAddress})]},t.id),ke=({logs:t,sortField:r,sortDirection:a,onSort:o})=>t.length===0?e.jsx(K,{children:e.jsx("p",{children:"No audit logs found matching your criteria."})}):e.jsxs(X,{children:[e.jsx(ye,{sortField:r,sortDirection:a,onSort:o}),e.jsx("tbody",{children:t.map(l=>e.jsx(ve,{log:l},l.id))})]}),Ne=[{id:1,timestamp:"2024-01-15T10:30:00Z",user:"admin@nanwa.com",action:"CREATE",resource:"Tree",resourceId:"tree_001",details:"Created new tree record for Forest A",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"},{id:2,timestamp:"2024-01-15T10:25:00Z",user:"user@nanwa.com",action:"UPDATE",resource:"Tree",resourceId:"tree_002",details:"Updated height measurement from 2.3m to 2.4m",ipAddress:"192.168.1.101",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},{id:3,timestamp:"2024-01-15T10:20:00Z",user:"admin@nanwa.com",action:"DELETE",resource:"Forest",resourceId:"forest_003",details:"Deleted forest record due to data cleanup",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"},{id:4,timestamp:"2024-01-15T10:15:00Z",user:"user@nanwa.com",action:"LOGIN",resource:"Authentication",resourceId:"auth_session_001",details:"User logged in successfully",ipAddress:"192.168.1.101",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},{id:5,timestamp:"2024-01-15T10:10:00Z",user:"admin@nanwa.com",action:"UPDATE",resource:"User",resourceId:"user_001",details:"Updated user permissions to admin level",ipAddress:"192.168.1.100",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"},{id:6,timestamp:"2024-01-15T10:05:00Z",user:"system",action:"CREATE",resource:"Measurement",resourceId:"measurement_001",details:"Automated measurement recorded for tree batch",ipAddress:"127.0.0.1",userAgent:"System/1.0"},{id:7,timestamp:"2024-01-15T10:00:00Z",user:"user@nanwa.com",action:"LOGOUT",resource:"Authentication",resourceId:"auth_session_002",details:"User logged out",ipAddress:"192.168.1.101",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}],we=()=>{const[t,r]=d.useState([]),[a,o]=d.useState(!1),l=async()=>{o(!0);try{await new Promise(i=>setTimeout(i,500)),r(Ne)}catch(i){console.error("Failed to fetch audit logs:",i)}finally{o(!1)}};return d.useEffect(()=>{l()},[]),{auditLogs:t,loading:a,refetchAuditLogs:l}},Ae=t=>{const[r,a]=d.useState(""),[o,l]=d.useState(""),[i,y]=d.useState("timestamp"),[c,k]=d.useState("desc"),u=d.useMemo(()=>t.filter(h=>{const b=r===""||h.user.toLowerCase().includes(r.toLowerCase())||h.details.toLowerCase().includes(r.toLowerCase())||h.resource.toLowerCase().includes(r.toLowerCase()),n=o===""||h.action===o;return b&&n}).sort((h,b)=>{const n=h[i],v=b[i];return c==="asc"?n>v?1:-1:n<v?1:-1}),[t,r,o,i,c]);return{searchTerm:r,setSearchTerm:a,actionFilter:o,setActionFilter:l,sortField:i,sortDirection:c,filteredAndSortedLogs:u,handleSort:h=>{i===h?k(c==="asc"?"desc":"asc"):(y(h),k("desc"))}}},Te=(t,r=G)=>{const[a,o]=d.useState(1),l=Math.ceil(t.length/r),i=(a-1)*r,y=t.slice(i,i+r);return d.useEffect(()=>{o(1)},[t.length]),{currentPage:a,setCurrentPage:o,totalPages:l,startIndex:i,paginatedData:y,pageSize:r}},Ce=()=>{const{auditLogs:t,loading:r}=we(),{searchTerm:a,setSearchTerm:o,actionFilter:l,setActionFilter:i,sortField:y,sortDirection:c,filteredAndSortedLogs:k,handleSort:u}=Ae(t),{currentPage:m,setCurrentPage:h,totalPages:b,startIndex:n,paginatedData:v,pageSize:A}=Te(k,G);return e.jsxs(Y,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Audit Log"}),e.jsx(be,{searchTerm:a,setSearchTerm:o,actionFilter:l,setActionFilter:i})]}),r?e.jsx(B,{text:"Loading audit logs..."}):e.jsx(ke,{logs:v,sortField:y,sortDirection:c,onSort:u}),e.jsx(oe,{currentPage:m,totalPages:b,startIndex:n,pageSize:A,totalItems:k.length,onPageChange:h})]})},Se=f.header`
  background: white;
  border-bottom: 1px solid #e5e7eb;
  padding: 1rem 0;
`,Ie=f.div`
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
`,Le=f.a`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: #10b981;
  color: white;
  text-decoration: none;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.2s;
  
  &:hover {
    background: #059669;
  }
`,Ee=f.span`
  padding: 0.5rem 1rem;
  background: #fee2e2;
  color: #991b1b;
  border-radius: 9999px;
  font-size: 0.875rem;
  font-weight: 500;
`,Me=f.div`
  display: flex;
  align-items: center;
  gap: 1rem;
`,De=f.span`
  font-size: 0.875rem;
  color: #374151;
`,Fe=f.button`
  color: #374151;
  background: none;
  border: none;
  padding: 0.5rem;
  border-radius: 0.375rem;
  cursor: pointer;
  transition: color 0.2s;
  
  &:hover {
    color: #10b981;
  }
`,Pe=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),Oe=()=>e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),_e=()=>{const{user:t,logout:r}=U(),a=async()=>{await r()};return e.jsx(Se,{children:e.jsxs(Ie,{children:[e.jsxs(Le,{href:"/dashboard",children:[e.jsx(Pe,{}),"Back to Dashboard"]}),e.jsxs(Me,{children:[e.jsx(Ee,{children:"Admin Panel"}),e.jsxs(De,{children:["Welcome, ",e.jsx("strong",{children:t==null?void 0:t.name})]}),e.jsx(Fe,{onClick:a,"aria-label":"Logout",children:e.jsx(Oe,{})})]})]})})},Ue=f.div`
  background: white;
  padding: 1.5rem;
  border-radius: 0.75rem;
  border: 1px solid #e5e7eb;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
`,ze=f.div`
  font-size: 2rem;
  font-weight: 700;
  color: #111827;
  margin-bottom: 0.5rem;
`,We=f.div`
  font-size: 0.875rem;
  color: #6b7280;
  font-weight: 500;
`,Be=f.div`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 3rem;
  height: 3rem;
  border-radius: 0.75rem;
  margin-bottom: 1rem;
  
  ${t=>{switch(t.type){case"users":return"background: #dbeafe; color: #1e40af;";case"actions":return"background: #d1fae5; color: #065f46;";case"errors":return"background: #fee2e2; color: #991b1b;";case"activity":return"background: #fef3c7; color: #92400e;";default:return"background: #f3f4f6; color: #374151;"}}}
`,He=({icon:t,value:r,label:a,type:o})=>e.jsxs(Ue,{children:[e.jsx(Be,{type:o,children:t}),e.jsx(ze,{children:r}),e.jsx(We,{children:a})]}),Re=f.div`
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
`,qe=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),Ge=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),$e=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),Ze=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),Ve=()=>{const t=[{icon:e.jsx(qe,{}),value:"42",label:"Active Users",type:"users"},{icon:e.jsx(Ge,{}),value:"1,247",label:"Total Actions Today",type:"actions"},{icon:e.jsx($e,{}),value:"3",label:"Failed Actions",type:"errors"},{icon:e.jsx(Ze,{}),value:"98.5%",label:"System Uptime",type:"activity"}];return e.jsx(Re,{children:t.map((r,a)=>e.jsx(He,{icon:r.icon,value:r.value,label:r.label,type:r.type},a))})};delete q.Icon.Default.prototype._getIconUrl;q.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const Ke=({position:t,setPosition:r})=>{const a=xe({click(o){const l=[o.latlng.lat,o.latlng.lng];r(l),a.flyTo(o.latlng,a.getZoom())}});return t===null?null:e.jsx(he,{position:t})},Xe=({latitude:t,longitude:r,onLocationChange:a,height:o="300px",className:l=""})=>{const[i,y]=d.useState(null);d.useEffect(()=>{t&&r&&!isNaN(parseFloat(t))&&!isNaN(parseFloat(r))&&y([parseFloat(t),parseFloat(r)])},[t,r]),d.useEffect(()=>{i&&a&&a({latitude:i[0].toString(),longitude:i[1].toString()})},[i,a]);const c=(m,h)=>{const b=parseFloat(m),n=parseFloat(h);!isNaN(b)&&!isNaN(n)&&b>=-90&&b<=90&&n>=-180&&n<=180&&y([b,n])},u=i||[59.3293,18.0686];return e.jsxs("div",{className:l,children:[e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Latitude"}),e.jsx("input",{type:"number",step:"any",value:i?i[0]:t||"",onChange:m=>c(m.target.value,i?i[1]:r),className:"form-input w-full",placeholder:"e.g., 59.3293"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Longitude"}),e.jsx("input",{type:"number",step:"any",value:i?i[1]:r||"",onChange:m=>c(i?i[0]:t,m.target.value),className:"form-input w-full",placeholder:"e.g., 18.0686"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Click on the map to set the tree location, or enter coordinates manually above."}),e.jsx("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",style:{height:o},children:e.jsxs(ue,{center:u,zoom:i?15:10,style:{height:"100%",width:"100%"},children:[e.jsx(ge,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(Ke,{position:i,setPosition:y})]},u.join(","))}),i&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[e.jsx("strong",{children:"Selected Location:"})," ",i[0].toFixed(6),", ",i[1].toFixed(6)]})})]})},Je=({isOpen:t,onClose:r,tree:a=null,onSuccess:o})=>{const{user:l}=U(),[i,y]=d.useState([]),[c,k]=d.useState(!1),[u,m]=d.useState({}),[h,b]=d.useState(!1),[n,v]=d.useState({treeId:"",forestId:"",species:"",plantedDate:"",latitude:"",longitude:"",soilCondition:"",sunlightExposure:"",notes:""}),A=!!a;d.useEffect(()=>{t&&(async()=>{var x;try{const p=await me.getAll(),j=((x=p.data)==null?void 0:x.forests)||p.data||[];y(j)}catch(p){console.error("Failed to load forests:",p)}})()},[t]),d.useEffect(()=>{var s,x,p,j,I,L,z,W;v(a?{treeId:a.treeId||"",forestId:((s=a.forestId)==null?void 0:s._id)||a.forestId||"",species:a.species||"",plantedDate:a.plantedDate?new Date(a.plantedDate).toISOString().split("T")[0]:"",latitude:((p=(x=a.location)==null?void 0:x.coordinates)==null?void 0:p[1])||a.lat||"",longitude:((I=(j=a.location)==null?void 0:j.coordinates)==null?void 0:I[0])||a.lng||"",soilCondition:((L=a.metadata)==null?void 0:L.soilCondition)||"",sunlightExposure:((z=a.metadata)==null?void 0:z.sunlightExposure)||"",notes:((W=a.metadata)==null?void 0:W.notes)||""}:{treeId:"",forestId:"",species:"",plantedDate:"",latitude:"",longitude:"",soilCondition:"",sunlightExposure:"",notes:""}),m({})},[a]);const N=(s,x)=>{v(p=>({...p,[s]:x})),u[s]&&m(p=>({...p,[s]:null}))},D=({latitude:s,longitude:x})=>{v(p=>({...p,latitude:s,longitude:x})),m(p=>({...p,latitude:null,longitude:null}))},F=()=>{const s={};if(n.treeId.trim()||(s.treeId="Tree ID is required"),n.forestId||(s.forestId="Forest is required"),n.species.trim()||(s.species="Species is required"),n.plantedDate||(s.plantedDate="Planted date is required"),!n.latitude||isNaN(parseFloat(n.latitude)))s.latitude="Valid latitude is required";else{const x=parseFloat(n.latitude);(x<-90||x>90)&&(s.latitude="Latitude must be between -90 and 90")}if(!n.longitude||isNaN(parseFloat(n.longitude)))s.longitude="Valid longitude is required";else{const x=parseFloat(n.longitude);(x<-180||x>180)&&(s.longitude="Longitude must be between -180 and 180")}return m(s),Object.keys(s).length===0},P=async s=>{var x,p;if(s.preventDefault(),!!F()){k(!0);try{const j={treeId:n.treeId,forestId:n.forestId,species:n.species,plantedDate:n.plantedDate,location:{type:"Point",coordinates:[parseFloat(n.longitude),parseFloat(n.latitude)]},metadata:{soilCondition:n.soilCondition||void 0,sunlightExposure:n.sunlightExposure||void 0,notes:n.notes||void 0}};A?await M.update(a._id,j):await M.create(j),o==null||o(),r()}catch(j){console.error("Failed to save tree:",j),m({submit:((p=(x=j.response)==null?void 0:x.data)==null?void 0:p.message)||`Failed to ${A?"update":"create"} tree`})}finally{k(!1)}}},g=[{value:"",label:"Select sunlight exposure"},{value:"full_sun",label:"Full Sun"},{value:"partial_sun",label:"Partial Sun"},{value:"partial_shade",label:"Partial Shade"},{value:"full_shade",label:"Full Shade"}];return e.jsx(ae,{isOpen:t,onClose:r,title:`${A?"Edit":"Create"} Tree`,children:e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[u.submit&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:u.submit}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{label:"Tree ID",required:!0,error:u.treeId,children:e.jsx("input",{type:"text",value:n.treeId,onChange:s=>N("treeId",s.target.value),className:"form-input",placeholder:"e.g., TREE-001",disabled:c})}),e.jsx(w,{label:"Forest",required:!0,error:u.forestId,children:e.jsxs("select",{value:n.forestId,onChange:s=>N("forestId",s.target.value),className:"form-input",disabled:c,children:[e.jsx("option",{value:"",children:"Select a forest"}),i.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{label:"Species",required:!0,error:u.species,children:e.jsx("input",{type:"text",value:n.species,onChange:s=>N("species",s.target.value),className:"form-input",placeholder:"e.g., Pine, Oak, Birch",disabled:c})}),e.jsx(w,{label:"Planted Date",required:!0,error:u.plantedDate,children:e.jsx("input",{type:"date",value:n.plantedDate,onChange:s=>N("plantedDate",s.target.value),className:"form-input",disabled:c})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 dark:text-white",children:"Tree Location"}),e.jsx("button",{type:"button",onClick:()=>b(!h),className:"text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 font-medium",disabled:c,children:h?"Use Manual Entry":"Use Map Picker"})]}),h?e.jsx(w,{label:"Select Location on Map",required:!0,error:u.latitude||u.longitude,children:e.jsx(Xe,{latitude:n.latitude,longitude:n.longitude,onLocationChange:D,height:"400px"})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{label:"Latitude",required:!0,error:u.latitude,helpText:"Between -90 and 90 degrees",children:e.jsx("input",{type:"number",step:"any",value:n.latitude,onChange:s=>N("latitude",s.target.value),className:"form-input",placeholder:"e.g., 59.3293",disabled:c})}),e.jsx(w,{label:"Longitude",required:!0,error:u.longitude,helpText:"Between -180 and 180 degrees",children:e.jsx("input",{type:"number",step:"any",value:n.longitude,onChange:s=>N("longitude",s.target.value),className:"form-input",placeholder:"e.g., 18.0686",disabled:c})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{label:"Soil Condition",error:u.soilCondition,children:e.jsx("input",{type:"text",value:n.soilCondition,onChange:s=>N("soilCondition",s.target.value),className:"form-input",placeholder:"e.g., Sandy, Clay, Loamy",disabled:c})}),e.jsx(w,{label:"Sunlight Exposure",error:u.sunlightExposure,children:e.jsx("select",{value:n.sunlightExposure,onChange:s=>N("sunlightExposure",s.target.value),className:"form-input",disabled:c,children:g.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})})]}),e.jsx(w,{label:"Notes",error:u.notes,children:e.jsx("textarea",{value:n.notes,onChange:s=>N("notes",s.target.value),className:"form-input resize-none",rows:"3",placeholder:"Additional notes about the tree...",disabled:c})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",disabled:c,children:c?"Saving...":A?"Update Tree":"Create Tree"})]})]})})},Qe=()=>{const[t,r]=d.useState([]),[a,o]=d.useState(!0),[l,i]=d.useState(""),[y,c]=d.useState(null),[k,u]=d.useState(!1),[m,h]=d.useState(1),[b,n]=d.useState(1),v=async(g="",s=1)=>{var x,p;try{o(!0);const j=await M.getAll({page:s,limit:10,search:g}),I=((x=j.data)==null?void 0:x.trees)||[],L=((p=j.data)==null?void 0:p.pagination)||{};r(I),n(Math.ceil(L.total/10)||1)}catch(j){console.error("Failed to load trees:",j),r([])}finally{o(!1)}};d.useEffect(()=>{v(l,m)},[l,m]);const A=()=>{c(null),u(!0)},N=g=>{c(g),u(!0)},D=async g=>{if(window.confirm("Are you sure you want to delete this tree?"))try{await M.delete(g),v(l,m)}catch(s){console.error("Failed to delete tree:",s),alert("Failed to delete tree. Please try again.")}},F=()=>{v(l,m)},P=g=>{i(g.target.value),h(1)};return a&&t.length===0?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(B,{text:"Loading trees..."})}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Tree Management"}),e.jsx("button",{onClick:A,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Add Tree"})]}),e.jsx(R,{type:"text",placeholder:"Search trees by ID or species...",value:l,onChange:P})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Tree ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Species"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Forest"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.map(g=>{var s,x;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-900",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:g.treeId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:g.species}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:((s=g.forestId)==null?void 0:s.name)||"Unknown"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300",children:(x=g.location)!=null&&x.coordinates?`${g.location.coordinates[1].toFixed(4)}, ${g.location.coordinates[0].toFixed(4)}`:"No location"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${g.isAlive?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"}`,children:g.isAlive?"Alive":"Dead"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>N(g),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:"Edit"}),e.jsx("button",{onClick:()=>D(g._id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:"Delete"})]})})]},g._id)})})]})}),t.length===0&&!a&&e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:l?"No trees found matching your search.":"No trees found."}),b>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Page ",m," of ",b]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>h(g=>Math.max(1,g-1)),disabled:m===1,className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>h(g=>Math.min(b,g+1)),disabled:m===b,className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded disabled:opacity-50",children:"Next"})]})]})}),e.jsx(Je,{isOpen:k,onClose:()=>u(!1),tree:y,onSuccess:F})]})},Ye=f.div`
  min-height: 100vh;
  background-color: #f9fafb;
`,et=f.main`
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
`,tt=f.div`
  margin-bottom: 2rem;
`,at=f.h1`
  font-size: 2.5rem;
  font-weight: 700;
  color: #111827;
  margin: 0 0 1rem 0;
`,rt=f.p`
  color: #6b7280;
  font-size: 1.125rem;
  margin: 0;
`,st=({children:t})=>e.jsx(Ye,{children:t}),nt=({title:t,description:r})=>e.jsxs(tt,{children:[e.jsx(at,{children:t}),e.jsx(rt,{children:r})]}),ot=({children:t})=>e.jsx(et,{children:t}),mt=()=>{const{isAdmin:t}=U(),[r,a]=d.useState("audit");if(!t())return e.jsx(V,{to:"/dashboard",replace:!0});const o=[{id:"audit",label:"Audit Logs"},{id:"trees",label:"Tree Management"}],l=()=>{switch(r){case"trees":return e.jsx(Qe,{});case"audit":default:return e.jsx(Ce,{})}};return e.jsxs(st,{children:[e.jsx(_e,{}),e.jsxs(ot,{children:[e.jsx(nt,{title:"System Administration",description:"Monitor system activity, manage trees, and view comprehensive audit logging."}),e.jsx(Ve,{}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow mb-6",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:o.map(i=>e.jsx("button",{onClick:()=>a(i.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${r===i.id?"border-green-500 text-green-600 dark:text-green-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300"}`,children:i.label},i.id))})}),e.jsx("div",{className:"p-6",children:l()})]})]})]})};export{mt as AdminPage};
